<html>
<head>
<title>Truncations.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Truncations.v</h1>

<div class="code" title="File: Truncations.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)

(** * Truncations of types, in all dimensions. *)

</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 4
Time: 0.049s">
<div class="time" style="width: 100%"></div>
<pre>Require Import Basics types.Sigma HProp ReflectiveSubuniverse Modality.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 4
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 5
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope equiv_scope.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Generalizable Variables A X n.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Definition. *)

(** The definition of [Trunc n], the n-truncation of a type.

If Coq supported higher inductive types natively, we would construct this as somthing like:

   Inductive Truncation n (A : Type) : Type :=
   | truncation_incl : A -&gt; Truncation n A
   | istrunc_truncation : forall (f : Sphere (trunc_S n) -&gt; Truncation n A)
       (x : Sphere (trunc_S n)), f x = f North.

However, while we are faking our higher-inductives anyway, we can take some shortcuts, rather than translating the definition above.  Firstly, we directly posit a “constructor” giving truncatedness, rather than rephrasing it in terms of maps of spheres.  Secondly, we omit the “computation rule” for this constructor, since it is implied by truncatedness of the result type (and, for essentially that reason, is never wanted in practice anyway).
*)

</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 22
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Export Truncation.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 22
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Delimit Scope trunc_scope with trunc.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 23
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Private Inductive Truncation (n : trunc_index) (A :Type) : Type :=
  truncation_incl : A -&gt; Truncation n A.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 26
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Bind Scope trunc_scope with Truncation.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 27
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments truncation_incl {n A} a.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 28
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
(** Make the priority 1, so that we don't override, e.g., [Unit]. *)</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 29
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Instance istrunc_truncation : forall n A, IsTrunc n (Truncation n A) | 1.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 29
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Admitted.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 30
Time: 0.002s">
<div class="time" style="width: 4.0816326530612%"></div>
<pre>

Definition Truncation_rect {n A}
  (P : Truncation n A -&gt; Type) `{forall aa, IsTrunc n (P aa)}
  : (forall a, P (truncation_incl a)) -&gt; (forall aa, P aa)
:= (fun f aa =&gt; match aa with truncation_incl a =&gt; f a end).</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 35
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Truncation.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The non-dependent version of the eliminator. *)

</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 40
Time: 0.002s">
<div class="time" style="width: 4.0816326530612%"></div>
<pre>Definition Truncation_rect_nondep {n A X} `{IsTrunc n X}
  : (A -&gt; X) -&gt; (Truncation n A -&gt; X)
:= Truncation_rect (fun _ =&gt; X).</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 42
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Truncation is a modality *)

</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 45
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section TruncationModality.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 45
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (n : trunc_index).</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 46
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Local Instance truncation_modality : Modality.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 48
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 49
Time: 0.028s">
<div class="time" style="width: 57.142857142857%"></div>
<pre>
    refine (Build_Modality
              (Build_UnitSubuniverse
                (fun A =&gt; IsTrunc n A)
                (Truncation n)
                _
                (@truncation_incl n)
                _)
              _
              (@Truncation_rect n)
              (fun A B B_inO f a =&gt; 1)
              _); cbn; try exact _.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros A B ? f ?; cbn in *.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply trunc_equiv with f; exact _.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 62
Time: 0.009s">
<div class="time" style="width: 18.367346938776%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 63
Time: 0.006s">
<div class="time" style="width: 12.244897959184%"></div>
<pre>

  Definition trunc_iff_isequiv_truncation (A : Type)
  : IsTrunc n A &lt;-&gt; IsEquiv (@truncation_incl n A)
  := inO_iff_isequiv_O_unit A.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 67
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** ** Functoriality *)

 </pre>
</div>
<div class="code" title="File: Truncations.v
Line: 71
Time: 0.004s">
<div class="time" style="width: 8.1632653061224%"></div>
<pre>Definition Truncation_functor {X Y} (f : X -&gt; Y)
  : Truncation n X -&gt; Truncation n Y
  := O_functor f.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 73
Time: 0.008s">
<div class="time" style="width: 16.326530612245%"></div>
<pre>

  Definition Truncation_functor_compose {X Y Z} (f : X -&gt; Y) (g : Y -&gt; Z)
  : Truncation_functor (g o f) == Truncation_functor g o Truncation_functor f
  := O_functor_compose f g.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 77
Time: 0.005s">
<div class="time" style="width: 10.204081632653%"></div>
<pre>

  Definition Truncation_functor_idmap (X : Type)
  : @Truncation_functor X X idmap == idmap
  := O_functor_idmap X.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 81
Time: 0.005s">
<div class="time" style="width: 10.204081632653%"></div>
<pre>

  Definition isequiv_Truncation_functor {X Y} (f : X -&gt; Y) `{IsEquiv _ _ f}
  : IsEquiv (Truncation_functor f)
  := isequiv_O_functor f.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 85
Time: 0.006s">
<div class="time" style="width: 12.244897959184%"></div>
<pre>

  Definition equiv_Truncation_prod_cmp `{Funext} {X Y}
  : Truncation n (X * Y) &lt;~&gt; Truncation n X * Truncation n Y
  := equiv_O_prod_cmp X Y.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 89
Time: 0.004s">
<div class="time" style="width: 8.1632653061224%"></div>
<pre>

End TruncationModality.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This coercion allows us to use truncation indices where a modality is expected and refer to the corresponding truncation modality.  For instance, the general theory of O-connected maps specializes to the theory of n-connected maps. *)</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Coercion truncation_modality : trunc_index &gt;-&gt; Modality.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** It's sometimes convenient to use "infinity" to refer to the identity modality in a similar way.  This clashes with some uses in higher topos theory, where "oo-truncated" means instead "hypercomplete", but this has not yet been a big problem. *)</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 95
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Notation oo := identity_modality.</pre>
</div>
<div class="code" title="File: Truncations.v
Line: 96
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

