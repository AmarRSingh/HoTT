<html>
<head>
<title>Modality.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Modality.v</h1>

<div class="code" title="File: Modality.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1
Time: 0.063s">
<div class="time" style="width: 8.3223249669749%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1
Time: 0.022s">
<div class="time" style="width: 2.9062087186262%"></div>
<pre>
Require Import Fibrations EquivalenceVarieties Extensions Factorization NullHomotopy.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 2
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
Require Export ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* [Export] because many of the lemmas and facts about reflective subuniverses are equally important for modalities. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Require Import HoTT.Tactics.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 5
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope equiv_scope.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Modalities *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 9
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 9
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter Modality : Type2@{u a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 11
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** These are the same as for a reflective subuniverse. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 15
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter O_reflector : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 16
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check O_reflector@{u a i}.    (** Verify that we have the right number of universes *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 19
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter inO_internal : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 20
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check inO_internal@{u a i}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 23
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter O_inO_internal : forall (O : Modality@{u a}) (T : Type@{i}),
                               inO_internal@{u a i} O (O_reflector@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 24
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check O_inO_internal@{u a i}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 27
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter to : forall (O : Modality@{u a}) (T : Type@{i}),
                   T -&gt; O_reflector@{u a i} O T.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 28
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check to@{u a i}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 31
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Parameter inO_equiv_inO_internal :
      forall (O : Modality@{u a}) (T U : Type@{i})
             (T_inO : inO_internal@{u a i} O T) (f : T -&gt; U) (feq : IsEquiv f),
        inO_internal@{u a i} O U.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 34
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check inO_equiv_inO_internal@{u a i}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 37
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Parameter hprop_inO_internal
  : Funext -&gt; forall (O : Modality@{u a}) (T : Type@{i}),
                IsHProp (inO_internal@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 39
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check hprop_inO_internal@{u a i}.

  (** Now instead of [extendable_to_O], we have an ordinary induction principle. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 44
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Parameter O_ind_internal
  : forall (O : Modality@{u a})
           (A : Type2le@{i a})
           (B : O_reflector@{u a i} O A -&gt; Type2le@{j a})
           (B_inO : forall oa, inO_internal@{u a j} O (B oa)),
      (** We add an extra unused universe parameter [k] that's [&gt;= max(i,j)].  This seems to be necessary for some examples, such as [Nullification], which are constructed by way of an operation that requires such a universe.  *)
      let gei := ((fun x =&gt; x) : Type@{i} -&gt; Type@{k}) in
      let gej := ((fun x =&gt; x) : Type@{j} -&gt; Type@{k}) in
      (forall a, B (to O A a)) -&gt; forall a, B a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 52
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check O_ind_internal@{u a i j k}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 55
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>Parameter O_ind_beta_internal
  : forall (O : Modality@{u a})
           (A : Type@{i}) (B : O_reflector O A -&gt; Type@{j})
           (B_inO : forall oa, inO_internal@{u a j} O (B oa))
           (f : forall a : A, B (to O A a)) (a:A),
      O_ind_internal@{u a i j k} O A B B_inO f (to O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check O_ind_beta_internal@{u a i j k}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 63
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Parameter minO_paths
  : forall (O : Modality@{u a})
           (A : Type2le@{i a}) (A_inO : inO_internal@{u a i} O A) (z z' : A),
      inO_internal@{u a i} O (z = z').</pre>
</div>
<div class="code" title="File: Modality.v
Line: 66
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check minO_paths@{u a i}.

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 68
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>End Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 68
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modalities are reflective subuniverses *)

(** We show that modalities have underlying reflective subuniverses.  It is important in some applications, such as [Trunc], that this construction uses the general [O_ind] given as part of the modality data.  For instance, this ensures that [O_functor] reduces to simply an application of [O_ind].

  Note also that our choice of how to define reflective subuniverses differently from the book, using [ooExtendableAlong] enables us to prove this without using funext. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 75
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Modalities_to_ReflectiveSubuniverses
       (Os : Modalities) &lt;: ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 76
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Import Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 78
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

  Fixpoint O_extendable (O : Modality@{u a})
           (A : Type@{i}) (B : O_reflector O A -&gt; Type@{j})
           (B_inO : forall a, inO_internal@{u a j} O (B a)) (n : nat)
  : ExtendableAlong@{i i j k} n (to O A) B.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 84
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    destruct n as [|n].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 85
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact tt.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 87
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> split.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 87
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 88
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 88
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
        exists (O_ind_internal@{u a i j k} O A B B_inO g); intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply O_ind_beta_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply O_extendable; intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 92
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
        apply minO_paths; trivial.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 93
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 94
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition ReflectiveSubuniverse := Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 96
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector := O_reflector.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3807 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_internal := inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_inO_internal := O_inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to := to.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 102
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition inO_equiv_inO_internal := inO_equiv_inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition hprop_inO_internal := hprop_inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 104
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Corollary 7.7.8, part 1 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 107
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>Definition extendable_to_O_internal (O : ReflectiveSubuniverse@{u a})
    {P : Type@{i}} {Q : Type@{j}} {Q_inO : inO_internal@{u a j} O Q}
  : ooExtendableAlong@{i i j k} (to O P) (fun _ =&gt; Q)
    := fun n =&gt; O_extendable O P (fun _ =&gt; Q) (fun _ =&gt; Q_inO) n.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 110
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

End Modalities_to_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** Conversely, if a reflective subuniverse is closed under sigmas, it is a modality.  This is a bit annoying to state using modules, and in fact with our current definitions there doesn't seem to be a way to actually convince Coq to accept it.  However, this is not really a problem in practice: in most or all examples, constructing [O_ind] directly is just as easy, and preferable because it sometimes gives a judgmental computation rule.  However, for the sake of completeness, we include here the code that almost works. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type SigmaClosed (Os : ReflectiveSubuniverses).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Import Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 118
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  Parameter inO_sigma
  : forall (O : ReflectiveSubuniverse@{u a})
           (A:Type@{i}) (B:A -&gt; Type@{j})
           (A_inO : inO_internal@{u a i} O A)
           (B_inO : forall a, inO_internal@{u a j} O (B a)),
      inO_internal@{u a k} O {x:A &amp; B x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 125
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check inO_sigma@{u a i j k}.    (** Verify that we have the right number of universes *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>End SigmaClosed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We omit the module type, because Coq won't actually accept it (see below for why). *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 129
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Module ReflectiveSubuniverses_to_Modalities
       (Os : ReflectiveSubuniverses) (OsSigma : SigmaClosed Os).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 130
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
(** &lt;: Modalities. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 133
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Import Os OsSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 133
Time: 0.01s">
<div class="time" style="width: 1.3210039630119%"></div>
<pre>
  Module Import Os_Theory := ReflectiveSubuniverses_Theory Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 134
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality := ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 136
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector := O_reflector.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3807 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_internal := inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_inO_internal := O_inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 141
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to := to.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 142
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition inO_equiv_inO_internal := inO_equiv_inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 143
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition hprop_inO_internal := hprop_inO_internal@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 144
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The reason Coq won't actually accept this as a module of type [Modalities] is that the following definitions of [O_ind_internal] and [O_ind_beta_internal] have an extra universe parameter [k] that's at least as large as both [i] and [j].  This is because [extendable_to_O_internal] has such a parameter, which in turn is because [ooExtendableAlong] does.  Unfortunately, we can't directly instantiate [k] to [max(i,j)] because Coq doesn't allow "algebraic universes" in arbitrary position.  We could probably work around it by defining [ExtendableAlong] inductively rather than recursively, but given the non-usefulness of this construction in practice, that doesn't seem to be worth the trouble at the moment. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 147
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>Definition O_ind_internal (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, inO_internal@{u a j} O (B oa))
  : (forall a, B (to O A a)) -&gt; forall a, B a
  := fun g =&gt; pr1 ((O_ind_from_inO_sigma@{u a i j k k j} O (inO_sigma O))
                     A B B_inO g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 152
Time: 0.006s">
<div class="time" style="width: 0.79260237780713%"></div>
<pre>

  Definition O_ind_beta_internal (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, inO_internal@{u a j} O (B oa))
             (f : forall a : A, B (to O A a)) (a:A)
  : O_ind_internal O A B B_inO f (to O A a) = f a
  := pr2 ((O_ind_from_inO_sigma@{u a i j k k j} O (inO_sigma O))
                     A B B_inO f) a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 160
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  Definition minO_paths (O : Modality@{u a})
             (A : Type@{i}) (A_inO : inO_internal@{u a i} O A) (z z' : A)
  : inO_internal O (z = z')
  := @inO_paths@{u a i i} O A A_inO z z'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 165
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End ReflectiveSubuniverses_to_Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 167
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Easy modalities *)

(** Our definition of modality is slightly different from the one in the book, which requires an induction principle only into families of the form [fun oa =&gt; O (B oa)], and similarly only that path-spaces of types [O A] are modal, where "modal" means that the unit is an equivalence.  This is equivalent, roughly since every modal type [A] (in this sense) is equivalent to [O A].

However, our definition is more convenient in formalized applications because in some examples (such as [Trunc] and closed modalities), there is a naturally occurring [O_ind] into all modal types that is not judgmentally equal to the one that can be constructed by passing through [O] and back again.  Thus, when we apply general theorems about modalities to a particular modality such as [Trunc], the proofs will reduce definitionally to "the way we would have proved them directly" if we didn't know about general modalities.

On the other hand, in other examples (such as [~~] and open modalities) it is easier to construct the latter weaker induction principle.  Thus, we now show how to get from that to our definition of modality. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 177
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type EasyModalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 177
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter Modality : Type2@{u a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 179
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check Modality@{u a}.    (** Verify that we have the right number of universes *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 182
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter O_reflector : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 183
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check O_reflector@{u a i}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 186
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter to : forall (O : Modality@{u a}) (T : Type@{i}),
                   T -&gt; O_reflector@{u a i} O T.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check to@{u a i}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 190
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Parameter O_indO
  : forall (O : Modality@{u a}) (A : Type@{i})
           (B : O_reflector@{u a i} O A -&gt; Type@{j}),
      (forall a, O_reflector@{u a j} O (B (to O A a)))
      -&gt; forall z, O_reflector@{u a j} O (B z).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 194
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check O_indO@{u a i j}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 197
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>Parameter O_indO_beta
  : forall (O : Modality@{u a}) (A : Type@{i})
           (B : O_reflector@{u a i} O A -&gt; Type@{j})
           (f : forall a, O_reflector@{u a j} O (B (to O A a))) a,
      O_indO O A B f (to O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check O_indO_beta@{u a i j}.

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 204
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Parameter minO_pathsO
  : forall (O : Modality@{u a}) (A : Type@{i})
           (z z' : O_reflector@{u a i} O A),
      IsEquiv (to@{u a i} O (z = z')).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 207
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check minO_pathsO@{u a i}.

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>End EasyModalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Module EasyModalities_to_Modalities (Os : EasyModalities)
&lt;: Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 212
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Import Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 214
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality := Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 216
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3807 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 218
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_reflector := O_reflector@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 218
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to := to@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 219
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  Definition inO_internal
  : forall (O : Modality@{u a}), Type@{i} -&gt; Type@{i}
  := fun O A =&gt; IsEquiv@{i i} (to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 223
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition hprop_inO_internal `{Funext} (O : Modality@{u a})
             (T : Type@{i})
  : IsHProp (inO_internal@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 227
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold inO_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (hprop_isequiv (to O T)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 231
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

  Definition O_ind_internal (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, inO_internal@{u a j} O (B oa))
  : let gei := ((fun x =&gt; x) : Type@{i} -&gt; Type@{k}) in
    let gej := ((fun x =&gt; x) : Type@{j} -&gt; Type@{k}) in
    (forall a, B (to O A a)) -&gt; forall oa, B oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 238
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simpl; intros f oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 240
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (H := B_inO oa); unfold inO_internal in H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 241
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    apply ((to O (B oa))^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 242
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_indO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 243
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a; apply to, f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 244
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 245
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

  Definition O_ind_beta_internal (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, inO_internal@{u a j} O (B oa))
             (f : forall a : A, B (to O A a)) (a:A)
  : O_ind_internal O A B B_inO f (to O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 251
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold O_ind_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 253
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 254
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    apply @O_indO_beta with (f := fun x =&gt; to O _ (f x)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 255
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 256
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_inO_internal (O : Modality@{u a}) (A : Type@{i})
  : inO_internal@{u a i} O (O_reflector@{u a i} O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 260
Time: 0.008s">
<div class="time" style="width: 1.0568031704095%"></div>
<pre>
    refine (isequiv_adjointify (to O (O_reflector O A))
             (O_indO O (O_reflector O A) (fun _ =&gt; A) idmap) _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 262
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 263
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> intros x; pattern x; apply O_ind_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 264
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> intros oa; apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 264
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 265
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> intros a; apply ap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 265
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
        exact (O_indO_beta O (O_reflector O A) (fun _ =&gt; A) idmap a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 267
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      exact (O_indO_beta O (O_reflector O A) (fun _ =&gt; A) idmap a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 268
Time: 0.007s">
<div class="time" style="width: 0.92470277410832%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It seems to be surprisingly hard to show repleteness (without univalence).  We basically have to manually develop enough functoriality of [O] and naturality of [to O]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 272
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition inO_equiv_inO_internal (O : Modality@{u a}) (A B : Type@{i})
    (A_inO : inO_internal@{u a i} O A) (f : A -&gt; B) (feq : IsEquiv f)
  : inO_internal@{u a i} O B.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 274
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 275
Time: 0.036s">
<div class="time" style="width: 4.7556142668428%"></div>
<pre>
    refine (isequiv_commsq (to O A) (to O B) f
             (O_ind_internal O A (fun _ =&gt; O_reflector O B) _ (fun a =&gt; to O B (f a))) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 278
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros; apply O_inO_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 278
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 279
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> intros a; refine (O_ind_beta_internal O A (fun _ =&gt; O_reflector O B) _ _ a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 280
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply A_inO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 280
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 281
Time: 0.01s">
<div class="time" style="width: 1.3210039630119%"></div>
<pre> refine (isequiv_adjointify _
               (O_ind_internal O B (fun _ =&gt; O_reflector O A) _ (fun b =&gt; to O A (f^-1 b))) _ _);
        intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 283
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 284
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_inO_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 284
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 285
Time: 0.005s">
<div class="time" style="width: 0.66050198150594%"></div>
<pre> pattern x; refine (O_ind_internal O B _ _ _ x); intros.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 286
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 287
Time: 0.049s">
<div class="time" style="width: 6.4729194187583%"></div>
<pre> simpl; abstract (repeat rewrite O_ind_beta_internal; apply ap, eisretr).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 287
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 288
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> pattern x; refine (O_ind_internal O A _ _ _ x); intros.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 289
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 289
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 290
Time: 0.01s">
<div class="time" style="width: 1.3210039630119%"></div>
<pre> simpl; abstract (repeat rewrite O_ind_beta_internal; apply ap, eissect).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 290
Time: 0.023s">
<div class="time" style="width: 3.0383091149273%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 291
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition minO_paths (O : Modality@{u a})
             (A : Type@{i}) (A_inO : inO_internal@{u a i} O A) (a a' : A)
  : inO_internal O (a = a').</pre>
</div>
<div class="code" title="File: Modality.v
Line: 295
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 296
Time: 0.009s">
<div class="time" style="width: 1.1889035667107%"></div>
<pre>
    refine (inO_equiv_inO_internal O (to O A a = to O A a') _ _
                          (@ap _ _ (to O A) a a')^-1 _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (@isequiv_ap _ _ _ A_inO _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isequiv_inverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 301
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 302
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

End EasyModalities_to_Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 304
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We now move on to the general theory of modalities. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Modalities_Theory (Os : Modalities).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Export Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 309
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Module Export Os_ReflectiveSubuniverses
  := Modalities_to_ReflectiveSubuniverses Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 311
Time: 0.006s">
<div class="time" style="width: 0.79260237780713%"></div>
<pre>
Module Export RSU
  := ReflectiveSubuniverses_Theory Os_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 313
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** As with reflective subuniverses, we put this in a module so it can be exported separately (and it should be). *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Export Coercions.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Coercion modality_to_reflective_subuniverse
    := idmap : Modality -&gt; ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 317
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
End Coercions.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 318
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

Definition O_ind {O : Modality@{u a}}
           {A : Type@{i}} (B : O A -&gt; Type@{j})
           {B_inO : forall oa, In O (B oa)}
           (f : forall a, B (to O A a)) (oa : O A)
: B oa
:= O_ind_internal O A B B_inO f oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 325
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>

Definition O_ind_beta {O : Modality@{u a}}
           {A : Type@{i}} (B : O A -&gt; Type@{j})
           {B_inO : forall oa, In O (B oa)}
           (f : forall a : A, B (to O A a)) (a : A)
: @O_ind O A B B_inO f (to O A a) = f a
:= O_ind_beta_internal O A B B_inO f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 332
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Corollary 7.7.8, part 2 *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 334
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Global Instance inO_sigma {O : Modality} (A:Type) (B:A -&gt; Type)
       `{In O A} `{forall a, In O (B a)}
: In O {x:A &amp; B x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 336
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 337
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize dependent A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 338
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  refine (inO_sigma_from_O_ind _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 339
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros A B ? g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 340
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  exists (O_ind B g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 341
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply O_ind_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 342
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Theorem 7.3.9: The reflector [O] can be discarded inside a reflected sum. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 345
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition equiv_O_sigma_O {O : Modality} {A} (P : A -&gt; Type)
: O {x:A &amp; O (P x)} &lt;~&gt; O {x:A &amp; P x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 346
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 347
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  refine (equiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 348
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 349
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> apply O_rec; intros [a op]; revert op.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 349
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    apply O_rec; intros p.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 350
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (to O _ (a;p)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 351
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 352
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply O_rec; intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 352
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (to O _ (a ; to O _ p)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 353
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 354
Time: 0.007s">
<div class="time" style="width: 0.92470277410832%"></div>
<pre> unfold Sect; apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 354
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    intros [a p]; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 355
Time: 0.027s">
<div class="time" style="width: 3.5667107001321%"></div>
<pre>
    abstract (repeat rewrite O_rec_beta; reflexivity).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 356
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 357
Time: 0.005s">
<div class="time" style="width: 0.66050198150594%"></div>
<pre> unfold Sect; apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 357
Time: 0.009s">
<div class="time" style="width: 1.1889035667107%"></div>
<pre>
    intros [a op]; revert op; apply O_ind; try exact _; intros p; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 358
Time: 0.033s">
<div class="time" style="width: 4.3593130779392%"></div>
<pre>
    abstract (repeat rewrite O_rec_beta; reflexivity).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 359
Time: 0.084s">
<div class="time" style="width: 11.0964332893%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 360
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Corollary 7.3.10 *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 362
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Corollary equiv_sigma_inO_O {O : Modality} {A} `{In O A} (P : A -&gt; Type)
: {x:A &amp; O (P x)} &lt;~&gt; O {x:A &amp; P x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 363
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 364
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
  transitivity (O {x:A &amp; O (P x)}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 365
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 366
Time: 0.015s">
<div class="time" style="width: 1.9815059445178%"></div>
<pre> apply equiv_to_O; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 366
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 367
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply equiv_O_sigma_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 367
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 368
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The induction principle [O_ind], like most induction principles, is an equivalence. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section OIndEquiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {fs : Funext} (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 371
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section OIndEquivData.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 373
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

    Context {A : Type} (B : O A -&gt; Type) `{forall a, In O (B a)}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 375
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

    Global Instance isequiv_O_ind : IsEquiv (O_ind B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 377
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 378
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      apply isequiv_adjointify with (g := fun h =&gt; h oD to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 380
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 380
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 380
Time: 0.015s">
<div class="time" style="width: 1.9815059445178%"></div>
<pre>
        refine (O_ind (fun oa =&gt; O_ind B (h oD to O A) oa = h oa) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 381
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
        exact (O_ind_beta B (h oD to O A)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 382
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 383
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
        exact (O_ind_beta B f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 384
Time: 0.022s">
<div class="time" style="width: 2.9062087186262%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 385
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

    Definition equiv_O_ind
    : (forall a, B (to O A a)) &lt;~&gt; (forall oa, B oa)
    := BuildEquiv _ _ (O_ind B) _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 389
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Theorem 7.7.7 *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 392
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>Definition isequiv_oD_to_O
    : IsEquiv (fun (h : forall oa, B oa) =&gt; h oD to O A)
    := equiv_isequiv (equiv_inverse equiv_O_ind).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 394
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  End OIndEquivData.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 396
Time: 0.006s">
<div class="time" style="width: 0.79260237780713%"></div>
<pre>

  Local Definition isequiv_o_to_O (A B : Type) (B_inO : In O B)
  : IsEquiv (fun (h : O A -&gt; B) =&gt; h o to O A)
    := isequiv_oD_to_O (fun _ =&gt; B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 400
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

End OIndEquiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 402
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected types *)

(** Connectedness of a type, relative to a modality, can be defined in two equivalent ways: quantifying over all maps into modal types, or by considering just the universal case, the modal reflection of the type itself.  The former requires only core Coq, but blows up the size (universe level) of [IsConnected], since it quantifies over types; moreover, it is not even quite correct since (at least with a polymorphic modality) it should really be quantified over all universes.  Thus, we use the latter, although in most examples it requires HITs to define the modal reflection.

Question: is there a definition of connectedness (say, for n-types) that neither blows up the universe level, nor requires HIT's? *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 409
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Class IsConnected (O : Modality@{u a}) (A : Type@{i})
  := isconnected_contr_O : IsTrunc@{i} -2 (O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 410
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Check IsConnected@{u a i}.

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 412
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Existing Instance isconnected_contr_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 412
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedTypes.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 414
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 415
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_isconnected `{Funext} A
  : IsHProp (IsConnected O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 419
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 420
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold IsConnected; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 421
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 422
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything equivalent to a connected type is connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 425
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_equiv (A : Type) {B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnected O A -&gt; IsConnected O B.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 427
Time: 0.012s">
<div class="time" style="width: 1.5852047556143%"></div>
<pre>
    intros ?; refine (contr_equiv (O A) (O_functor O f)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 429
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

  Definition isconnected_equiv' (A : Type) {B : Type} (f : A &lt;~&gt; B)
  : IsConnected O A -&gt; IsConnected O B
    := isconnected_equiv A f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 433
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connectedness of a type [A] can equivalently be characterized by the fact that any map to an [O]-type [C] is nullhomotopic.  Here is one direction of that equivalence. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 436
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_elim {A : Type} `{IsConnected O A} (C : Type) `{In O C} (f : A -&gt; C)
  : NullHomotopy f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 437
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 438
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    set (ff := @O_rec O _ _ _ f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 439
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    exists (ff (center _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 440
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 441
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> symmetry.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 441
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    refine (ap ff (contr (to O _ a)) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 442
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_rec_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 443
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 444
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** For the other direction of the equivalence, it's sufficient to consider the case when [C] is [O A]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 447
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_from_elim_to_O {A : Type}
  : NullHomotopy (to O A) -&gt; IsConnected O A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 448
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 449
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros nh.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 450
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (nh .1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 451
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 452
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    intros; symmetry; apply (nh .2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 453
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 454
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Now the general case follows. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 457
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_from_elim {A : Type}
  : (forall (C : Type) `{In O C} (f : A -&gt; C), NullHomotopy f)
    -&gt; IsConnected O A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 459
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 460
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 461
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    exact (isconnected_from_elim_to_O (H (O A) (O_inO A) (to O A))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 462
Time: 0.008s">
<div class="time" style="width: 1.0568031704095%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 463
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A type which is both connected and truncated is contractible. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 467
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition contr_trunc_conn {A : Type} `{In O A} `{IsConnected O A}
  : Contr A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 468
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 469
Time: 0.009s">
<div class="time" style="width: 1.1889035667107%"></div>
<pre>
    apply (contr_equiv _ (to O A)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 471
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Here's another way of stating the universal property for mapping out of connected types into modal ones. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 474
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition extendable_const_isconnected_inO (n : nat)
             (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3811 *)
             (A : Type@{i}) {conn_A : IsConnected@{u a i} O A}
             (C : Type@{j}) `{In@{u a j} O C}
  : ExtendableAlong@{i i j j} n (@const A Unit@{i} tt) (fun _ =&gt; C).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 478
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 479
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    generalize dependent C;
      simple_induction n n IHn; intros C ?;
      [ exact tt | split ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 482
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 483
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 483
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      exists (fun _ =&gt; (isconnected_elim C f).1); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 484
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      symmetry; apply ((isconnected_elim C f).2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 485
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 486
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 486
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
      refine (extendable_postcompose' n _ _ _ _ (IHn (h tt = k tt) _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 487
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros []; apply equiv_idmap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 488
Time: 0.005s">
<div class="time" style="width: 0.66050198150594%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 489
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>

  Definition ooextendable_const_isconnected_inO
             (A : Type@{i}) `{IsConnected@{u a i} O A}
             (C : Type@{j}) `{In@{u a j} O C}
  : ooExtendableAlong (@const A Unit tt) (fun _ =&gt; C)
    := fun n =&gt; extendable_const_isconnected_inO@{i j k k j} n A C.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 495
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  Definition isequiv_const_isconnected_inO `{Funext}
             {A : Type} `{IsConnected O A} (C : Type) `{In O C}
  : IsEquiv (@const A C).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 499
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 500
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
    refine (@isequiv_compose _ _ (fun c u =&gt; c) _ _ _
              (isequiv_ooextendable (fun _ =&gt; C) (@const A Unit tt)
                                    (ooextendable_const_isconnected_inO A C))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 503
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 504
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>

End ConnectedTypes.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 506
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally truncated maps *)

(** A map is "in [O]" if each of its fibers is. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 511
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Class MapIn (O : Modality@{u a}) {A : Type@{i}} {B : Type@{j}} (f : A -&gt; B)
  := inO_hfiber_ino_map : forall (b:B), In@{u a k} O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 512
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Check MapIn@{u a i j k}.        (** k &gt;= max(i,j) *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Existing Instance inO_hfiber_ino_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ModalMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 516
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 517
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 520
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance mapinO_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 521
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 522
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 523
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (fcontr_isequiv f _ b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 524
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 525
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 526
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any map between modal types is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 529
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition mapinO_between_inO {A B : Type} (f : A -&gt; B)
             `{In O A} `{In O B}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 531
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 532
Time: 0.017s">
<div class="time" style="width: 2.2457067371202%"></div>
<pre>
    intros b; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 533
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 534
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a modal map is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 537
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition mapinO_homotopic {A B : Type} (f : A -&gt; B) {g : A -&gt; B}
             (p : f == g) `{MapIn O _ _ f}
  : MapIn O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 539
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 540
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 541
Time: 0.011s">
<div class="time" style="width: 1.4531043593131%"></div>
<pre>
    refine (inO_equiv_inO (hfiber f b)
                          (equiv_hfiber_homotopic f g p b)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 543
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 544
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being modal is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 547
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_mapinO `{Funext} {A B : Type} (f : A -&gt; B)
  : IsHProp (MapIn O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 548
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 549
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
    apply trunc_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 550
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The composite of modal maps is modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 554
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Global Instance mapinO_compose {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{MapIn O _ _ f} `{MapIn O _ _ g}
  : MapIn O (g o f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 556
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 557
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 558
Time: 0.757s">
<div class="time" style="width: 100%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_compose f g c)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 559
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 560
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

End ModalMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 562
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected maps *)

(** Connectedness of a map can again be defined in two equivalent ways: by connectedness of its fibers (as types), or by the lifting property/elimination principle against truncated types.  We use the former; the equivalence with the latter is given below in [conn_map_elim], [conn_map_comp], and [conn_map_from_extension_elim]. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 567
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Class IsConnMap (O : Modality@{u a}) {A : Type@{i}} {B : Type@{j}} (f : A -&gt; B)
  := isconnected_hfiber_conn_map : forall b:B, IsConnected@{u a k} O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 568
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Check IsConnMap@{u a i j k}.        (** k &gt;= max(i,j) *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 570
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Existing Instance isconnected_hfiber_conn_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 570
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 572
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{Univalence} `{Funext}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 573
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 574
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is connected *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 577
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance conn_map_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 578
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 579
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 580
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (fcontr_isequiv f _ b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 581
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    unfold IsConnected; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 582
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 583
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a connected map is connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 586
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition conn_map_homotopic {A B : Type} (f g : A -&gt; B) (h : f == g)
  : IsConnMap O f -&gt; IsConnMap O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 587
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 588
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros ? b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 589
Time: 0.01s">
<div class="time" style="width: 1.3210039630119%"></div>
<pre>
    exact (isconnected_equiv O (hfiber f b)
                             (equiv_hfiber_homotopic f g h b) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 591
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 592
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 595
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_isconnmap `{Funext} {A B : Type} (f : A -&gt; B)
  : IsHProp (IsConnMap O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 596
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 597
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
    apply trunc_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 598
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 599
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** n-connected maps are orthogonal to n-truncated maps (i.e. familes of n-truncated types). *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 602
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition conn_map_elim
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
             (d : forall a:A, P (f a))
  : forall b:B, P b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 606
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 607
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 608
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    refine (pr1 (isconnected_elim O _ _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 609
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    2:exact b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 610
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 611
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (transport P p (d a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 612
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 613
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  Definition conn_map_comp
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
             (d : forall a:A, P (f a))
  : forall a:A, conn_map_elim f P d (f a) = d a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 619
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 620
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 621
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> unfold conn_map_elim.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 621
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    set (fibermap := (fun a0p : hfiber f (f a)
                      =&gt; let (a0, p) := a0p in transport P p (d a0))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 623
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    destruct (isconnected_elim O (P (f a)) fibermap) as [x e].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 624
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    change (d a) with (fibermap (a;1)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 625
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply inverse, e.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 626
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 627
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  Definition isequiv_conn_ino_map {A B : Type} (f : A -&gt; B)
             `{IsConnMap O _ _ f} `{MapIn O _ _ f}
  : IsEquiv f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 631
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 632
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_fcontr.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 633
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 633
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    apply (contr_trunc_conn O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 634
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 635
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** We can re-express this in terms of extensions. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 638
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Lemma extension_conn_map_elim
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
  : ExtensionAlong f P d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 642
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 643
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 644
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_comp.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 645
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 646
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

  Lemma allpath_extension_conn_map
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
        (e e' : ExtensionAlong f P d)
  : e = e'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 653
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 654
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    apply path_extension.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 655
Time: 0.008s">
<div class="time" style="width: 1.0568031704095%"></div>
<pre>
    refine (extension_conn_map_elim _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 656
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 657
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It follows that [conn_map_elim] is actually an equivalence. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 660
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Theorem isequiv_o_conn_map 
          {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
          (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : IsEquiv (fun (g : forall b:B, P b) =&gt; g oD f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 663
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 664
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_fcontr; intros d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 665
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply contr_inhabited_hprop.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 666
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 667
Time: 0.202s">
<div class="time" style="width: 26.68428005284%"></div>
<pre> refine (@trunc_equiv' {g : forall b, P b &amp; g oD f == d} _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 667
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 668
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> refine (equiv_functor_sigma' (equiv_idmap _) _); intros g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 668
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply equiv_path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 669
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 669
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply hprop_allpath.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 670
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g h.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 670
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      exact (allpath_extension_conn_map f P d g h).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 671
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 672
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 672
Time: 0.015s">
<div class="time" style="width: 1.9815059445178%"></div>
<pre>
      apply path_forall; intros x; apply conn_map_comp.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 673
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 674
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Conversely, if a map satisfies this elimination principle (expressed via extensions), then it is connected.  This completes the proof of Lemma 7.5.7 from the book. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 677
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Lemma conn_map_from_extension_elim {A B : Type} (f : A -&gt; B)
  : (forall (P : B -&gt; Type) {P_inO : forall b:B, In O (P b)}
            (d : forall a:A, P (f a)),
       ExtensionAlong f P d)
    -&gt; IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 681
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 682
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros Hf b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 683
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isconnected_from_elim_to_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 683
Time: 0.005s">
<div class="time" style="width: 0.66050198150594%"></div>
<pre>
    assert (e := Hf (fun b =&gt; O (hfiber f b)) _ (fun a =&gt; to O _ (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 684
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    exists (e.1 b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 685
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 686
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> destruct p.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 686
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    symmetry; apply (e.2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 687
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 688
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Corollary 7.5.8: It follows that the unit maps [to O A] are connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 691
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance conn_map_to_O (A : Type) : IsConnMap O (to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 691
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 692
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 693
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    exists (O_ind P d); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 694
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_ind_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 695
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 696
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.6: Connected maps compose and cancel on the right. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 699
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>Global Instance conn_map_compose {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ g}
  : IsConnMap O (g o f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 701
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 702
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 703
Time: 0.007s">
<div class="time" style="width: 0.92470277410832%"></div>
<pre>
    exists (conn_map_elim g P (conn_map_elim f (P o g) d)); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 704
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    exact (conn_map_comp g P _ _ @ conn_map_comp f (P o g) d a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 705
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 706
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>      

  Definition cancelR_conn_map {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ (g o f)}
  :  IsConnMap O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 710
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 711
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 712
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    exists (conn_map_elim (g o f) P (d oD f)); intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 713
Time: 0.009s">
<div class="time" style="width: 1.1889035667107%"></div>
<pre>
    pattern b; refine (conn_map_elim f _ _ b); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 714
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    exact (conn_map_comp (g o f) P (d oD f) a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 715
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 716
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (* Lemma 7.5.10: A map to a type in [O] exhibits its codomain as the [O]-reflection of its domain if (and only if) it is [O]-connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 719
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition isequiv_O_rec_conn_map {A B : Type} `{In O B}
             (f : A -&gt; B) `{IsConnMap O _ _ f}
  : IsEquiv (O_rec f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 721
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 722
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_conn_ino_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 723
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 724
Time: 0.062s">
<div class="time" style="width: 8.1902245706737%"></div>
<pre> refine (cancelR_conn_map (to O A) (O_rec f)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 724
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      refine (conn_map_homotopic f _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 725
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      intros a; symmetry; apply O_rec_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 726
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 727
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply mapinO_between_inO; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 727
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 728
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.12 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 731
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 731
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

    Context {A B : Type} {P : A -&gt; Type} {Q : B -&gt; Type}
            (f : A -&gt; B) (g : forall a, P a -&gt; Q (f a))
            `{forall a, IsConnMap O (g a)}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 735
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

    Definition equiv_O_hfiber_functor_sigma (b:B) (v:Q b)
    : O (hfiber (functor_sigma f g) (b;v)) &lt;~&gt; O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 738
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 739
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; hfiber (g w.1) ((w.2)^ # v)}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 740
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 741
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply equiv_O_functor, hfiber_functor_sigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 741
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 741
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; O (hfiber (g w.1) ((w.2)^ # v))}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 742
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 743
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre> symmetry; apply equiv_O_sigma_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 743
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 743
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 744
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
      apply equiv_sigma_contr; intros [a p]; simpl; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 745
Time: 0.007s">
<div class="time" style="width: 0.92470277410832%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 746
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

    Global Instance conn_map_functor_sigma `{IsConnMap O _ _ f}
    : IsConnMap O (functor_sigma f g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 749
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 750
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [b v].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 751
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Why is this so slow? *)
     </pre>
</div>
<div class="code" title="File: Modality.v
Line: 753
Time: 0.075s">
<div class="time" style="width: 9.9075297225892%"></div>
<pre>refine (contr_equiv _ (equiv_inverse (equiv_O_hfiber_functor_sigma b v))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 753
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 754
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

    Definition conn_map_base_inhabited (inh : forall b, Q b)
               `{IsConnMap O _ _ (functor_sigma f g)}
    : IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 758
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 759
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 760
Time: 0.018s">
<div class="time" style="width: 2.3778071334214%"></div>
<pre>
      refine (contr_equiv _ (equiv_O_hfiber_functor_sigma b (inh b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 761
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 762
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

  End ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 764
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.13.  The "if" direction is a special case of [conn_map_functor_sigma], so we prove only the "only if" direction. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 767
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition conn_map_fiber
             {A : Type} {P Q : A -&gt; Type} (f : forall a, P a -&gt; Q a)
             `{IsConnMap O _ _ (functor_sigma idmap f)}
  : forall a, IsConnMap O (f a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 770
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 771
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a q.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 772
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
    refine (isconnected_equiv' O (hfiber (functor_sigma idmap f) (a;q)) _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 773
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (hfiber_functor_sigma_idmap P Q f a q).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 774
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 775
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.14: Connected maps are inverted by [O]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 778
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Global Instance O_inverts_conn_map {A B : Type} (f : A -&gt; B)
         `{IsConnMap O _ _ f}
  : IsEquiv (O_functor O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 780
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 781
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    refine (isequiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 782
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 783
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply O_rec; intros y.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 783
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
      exact (O_functor O pr1 (center (O (hfiber f y)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 784
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 785
Time: 0.007s">
<div class="time" style="width: 0.92470277410832%"></div>
<pre> unfold Sect; apply O_ind; try exact _; intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 785
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
      refine (ap (O_functor O f) (O_rec_beta _ b) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 786
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
      refine ((O_functor_compose _ _ _ _)^ @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 787
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      set (x := (center (O (hfiber f b)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 788
Time: 0.008s">
<div class="time" style="width: 1.0568031704095%"></div>
<pre>
      clearbody x; revert x; apply O_ind; try exact _; intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 789
Time: 0.006s">
<div class="time" style="width: 0.79260237780713%"></div>
<pre>
      refine (O_rec_beta (to O B o (f o pr1)) (a;p) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 790
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (ap (to O B) p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 791
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 792
Time: 0.008s">
<div class="time" style="width: 1.0568031704095%"></div>
<pre> unfold Sect; apply O_ind; try exact _; intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 792
Time: 0.004s">
<div class="time" style="width: 0.52840158520476%"></div>
<pre>
      refine (ap (O_rec _) (to_O_natural O f a) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 793
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
      refine (O_rec_beta _ _ @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 794
Time: 0.007s">
<div class="time" style="width: 0.92470277410832%"></div>
<pre>
      transitivity (O_functor O pr1 (to O (hfiber f (f a)) (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 795
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 796
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> apply ap, contr.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 796
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 797
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> refine (to_O_natural _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 797
Time: 0.022s">
<div class="time" style="width: 2.9062087186262%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 798
Time: 0.016s">
<div class="time" style="width: 2.113606340819%"></div>
<pre>

End ConnectedMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 800
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The modal factorization system *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 803
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ModalFact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 803
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{fs : Funext} (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 804
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.6.4 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 807
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition image {A B : Type} (f : A -&gt; B)
  : Factorization (@IsConnMap O) (@MapIn O) f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 808
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 809
Time: 0.027s">
<div class="time" style="width: 3.5667107001321%"></div>
<pre>
    refine (Build_Factorization {b : B &amp; O (hfiber f b)}
                                (fun a =&gt; (f a ; to O _ (a;1)))
                                pr1
                                (fun a =&gt; 1)
                                _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 814
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 815
Time: 0.065s">
<div class="time" style="width: 8.5865257595773%"></div>
<pre> exact (conn_map_compose O
              (equiv_fibration_replacement f)
              (functor_sigma idmap (fun b =&gt; to O (hfiber f b)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 817
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 818
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 818
Time: 0.013s">
<div class="time" style="width: 1.7173051519155%"></div>
<pre>
      exact (inO_equiv_inO _ (hfiber_fibration b (O o (hfiber f)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 819
Time: 0.005s">
<div class="time" style="width: 0.66050198150594%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 820
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** This is the composite of the three displayed equivalences at the beginning of the proof of Lemma 7.6.5.  Note that it involves only a single factorization of [f]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 823
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>Lemma O_hfiber_O_fact {A B : Type} {f : A -&gt; B}
        (fact : Factorization (@IsConnMap O) (@MapIn O) f) (b : B)
  : O (hfiber (factor2 fact o factor1 fact) b)
      &lt;~&gt; hfiber (factor2 fact) b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 826
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 827
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    refine (equiv_compose' _
             (equiv_O_functor O
               (hfiber_compose (factor1 fact) (factor2 fact) b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 830
Time: 0.061s">
<div class="time" style="width: 8.0581241743725%"></div>
<pre>
    refine (equiv_compose'
             (equiv_sigma_contr (fun w =&gt; O (hfiber (factor1 fact) w.1)))
             _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 833
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 834
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros w; exact (inclass1 fact w.1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 834
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 835
Time: 0.046s">
<div class="time" style="width: 6.0766182298547%"></div>
<pre> refine (equiv_inverse
                (equiv_sigma_inO_O (fun w =&gt; hfiber (factor1 fact) w.1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 836
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (inclass2 fact b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 837
Time: 0.005s">
<div class="time" style="width: 0.66050198150594%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 838
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** This is the corresponding first three of the displayed "mapsto"s in proof of Lemma 7.6.5, and also the last three in reverse order, generalized to an arbitrary path [p].  Note that it is much harder to prove than in the book, because we are working in the extra generality of a modality where [O_ind_beta] is only propositional. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 841
Time: 0.17s">
<div class="time" style="width: 22.457067371202%"></div>
<pre>Lemma O_hfiber_O_fact_inverse_beta {A B : Type} {f : A -&gt; B}
        (fact : Factorization (@IsConnMap O) (@MapIn O) f)
        (a : A) (b : B) (p : factor2 fact (factor1 fact a) = b)
  : (O_hfiber_O_fact fact b)^-1
      (factor1 fact a ; p) = to O _ (a ; p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 845
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 846
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    set (g := factor1 fact); set (h := factor2 fact).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 847
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
    apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 848
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold O_hfiber_O_fact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 849
Time: 0.145s">
<div class="time" style="width: 19.154557463672%"></div>
<pre>
    ev_equiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 850
Time: 0.006s">
<div class="time" style="width: 0.79260237780713%"></div>
<pre>
    apply moveL_equiv_M.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 851
Time: 0.016s">
<div class="time" style="width: 2.113606340819%"></div>
<pre>
    transitivity (existT (fun (w : hfiber h b) =&gt; O (hfiber g w.1))
                         (g a; p) (to O (hfiber g (g a)) (a ; 1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 853
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 854
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> apply moveR_equiv_V; reflexivity.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 854
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 855
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply moveL_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 855
Time: 0.019s">
<div class="time" style="width: 2.5099075297226%"></div>
<pre>
      transitivity (to O _ (existT (fun (w : hfiber h b) =&gt; (hfiber g w.1))
                         (g a; p) (a ; 1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 857
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 858
Time: 0.169s">
<div class="time" style="width: 22.324966974901%"></div>
<pre> simpl; repeat rewrite O_rec_beta; reflexivity.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 858
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 859
Time: 0.014s">
<div class="time" style="width: 1.8494055482166%"></div>
<pre> symmetry; apply to_O_natural.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 859
Time: 0.059s">
<div class="time" style="width: 7.7939233817701%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 860
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section TwoFactorizations.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 862
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
    Context {A B : Type} (f : A -&gt; B)
            (fact fact' : Factorization (@IsConnMap O) (@MapIn O) f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 864
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

    Let H := fun x =&gt; fact_factors fact x @ (fact_factors fact' x)^.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 866
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Lemma 7.6.5, part 1. *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 869
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>Definition equiv_O_factor_hfibers (b:B)
    : hfiber (factor2 fact) b &lt;~&gt; hfiber (factor2 fact') b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 870
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 871
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      refine (equiv_compose' (O_hfiber_O_fact fact' b) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 872
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      refine (equiv_compose' _ (equiv_inverse (O_hfiber_O_fact fact b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 873
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 874
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_hfiber_homotopic.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 875
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 876
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 877
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Lemma 7.6.5, part 2. *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 880
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>Definition equiv_O_factor_hfibers_beta (a : A)
    : equiv_O_factor_hfibers (factor2 fact (factor1 fact a))
                             (factor1 fact a ; 1)
      = (factor1 fact' a ; (H a)^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 883
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 884
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold equiv_O_factor_hfibers.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 885
Time: 0.227s">
<div class="time" style="width: 29.98678996037%"></div>
<pre>
      ev_equiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 886
Time: 0.431s">
<div class="time" style="width: 56.935270805812%"></div>
<pre>
      apply moveR_equiv_M.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 887
Time: 0.02s">
<div class="time" style="width: 2.6420079260238%"></div>
<pre>
      do 2 rewrite O_hfiber_O_fact_inverse_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 888
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold equiv_fun, equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 889
Time: 0.018s">
<div class="time" style="width: 2.3778071334214%"></div>
<pre>
      transitivity (to O _
                       (equiv_hfiber_homotopic
                          (factor2 fact o factor1 fact)
                          (factor2 fact' o factor1 fact') H
                          (factor2 fact (factor1 fact a)) (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 894
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 895
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre> refine (to_O_natural O _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 895
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 896
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> apply ap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 896
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
        simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 897
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
        apply ap; auto with path_hints.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 898
Time: 0.019s">
<div class="time" style="width: 2.5099075297226%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 899
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>

  End TwoFactorizations.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 901
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Theorem 7.6.6.  Recall that a lot of hard work was done in [Factorization.path_factorization]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_factsys : FactorizationSystem.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 905
Time: 0.048s">
<div class="time" style="width: 6.3408190224571%"></div>
<pre>
    refine (Build_FactorizationSystem
              (@IsConnMap O) _ _ _
              (@MapIn O) _ _ _
              (@image) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 909
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros A B f fact fact'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 910
Time: 0.006s">
<div class="time" style="width: 0.79260237780713%"></div>
<pre>
    refine (Build_PathFactorization fact fact' _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 911
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 912
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> refine (equiv_compose' _ (equiv_fibration_replacement (factor2 fact))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 912
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      refine (equiv_compose' (equiv_inverse (equiv_fibration_replacement (factor2 fact'))) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 913
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      refine (equiv_functor_sigma' (equiv_idmap B) _); intros b; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 914
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>
      apply equiv_O_factor_hfibers.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 915
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 916
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre> intros a; exact (pr1_path (equiv_O_factor_hfibers_beta f fact fact' a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 916
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 917
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 917
Time: 0.003s">
<div class="time" style="width: 0.39630118890357%"></div>
<pre>
      exact ((equiv_O_factor_hfibers f fact fact' (factor2 fact x) (x ; 1)).2 ^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 918
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 919
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 919
Time: 0.002s">
<div class="time" style="width: 0.26420079260238%"></div>
<pre>
      apply moveR_pM.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 920
Time: 0.04s">
<div class="time" style="width: 5.2840158520476%"></div>
<pre>
      refine ((inv_V _)^ @ _ @ inv_V _); apply inverse2.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 921
Time: 0.019s">
<div class="time" style="width: 2.5099075297226%"></div>
<pre>
      refine (_ @ pr2_path (equiv_O_factor_hfibers_beta f fact fact' a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 922
Time: 0.035s">
<div class="time" style="width: 4.6235138705416%"></div>
<pre>
      refine (_ @ (transport_paths_Fl _ _)^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 923
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (** Apparently Coq needs a little help to see that these paths are the same. *)
     </pre>
</div>
<div class="code" title="File: Modality.v
Line: 925
Time: 0.022s">
<div class="time" style="width: 2.9062087186262%"></div>
<pre>match goal with
          |- ((?p)^ @ ?q)^ = _ @ _ =&gt; change ((p^ @ q)^ = q^ @ p)
      end.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 927
Time: 0.058s">
<div class="time" style="width: 7.661822985469%"></div>
<pre>
      refine (inv_pp _ _ @ (1 @@ inv_V _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 928
Time: 0.182s">
<div class="time" style="width: 24.042272126816%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 929
Time: 0.05s">
<div class="time" style="width: 6.6050198150594%"></div>
<pre>

End ModalFact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 931
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Modalities_Theory.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 933
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Restriction of a family of modalities *)

(** This is just like restriction of reflective subuniverses. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 937
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type Modalities_Restriction_Data (Os : Modalities).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 937
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter New_Modality : Type2@{u a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 939
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter Modalities_restriction
  : New_Modality -&gt; Os.Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 942
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Modalities_Restriction_Data.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 944
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

Module Modalities_Restriction
       (Os : Modalities)
       (Res : Modalities_Restriction_Data Os)
&lt;: Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 949
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality := Res.New_Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 951
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector (O : Modality@{u a})
    := Os.O_reflector@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition inO_internal (O : Modality@{u a})
    := Os.inO_internal@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_inO_internal (O : Modality@{u a})
    := Os.O_inO_internal@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 958
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to (O : Modality@{u a})
    := Os.to@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 960
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition inO_equiv_inO_internal (O : Modality@{u a})
    := Os.inO_equiv_inO_internal@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 962
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition hprop_inO_internal (H : Funext) (O : Modality@{u a})
    := Os.hprop_inO_internal@{u a i} H (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 964
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_ind_internal (O : Modality@{u a})
    := Os.O_ind_internal@{u a i j k} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 966
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_ind_beta_internal (O : Modality@{u a})
    := Os.O_ind_beta_internal@{u a i j k} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition minO_paths (O : Modality@{u a})
    := Os.minO_paths@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 970
Time: 0.001s">
<div class="time" style="width: 0.13210039630119%"></div>
<pre>

End Modalities_Restriction.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 973
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** For examples of modalities, see the files Notnot, Identity, Nullification, PropositionalFracture, and hit/Localization. *)

</pre>
</div>
</body>
</html>

