<html>
<head>
<title>Modality.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Modality.v</h1>

<div class="code" title="File: Modality.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1
Time: 0.048s">
<div class="time" style="width: 9.5238095238095%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1
Time: 0.017s">
<div class="time" style="width: 3.3730158730159%"></div>
<pre>
Require Import Fibrations EquivalenceVarieties Extensions Factorization NullHomotopy HProp Pullback.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 2
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
Require Export ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* [Export] because many of the lemmas and facts about reflective subuniverses are equally important for modalities. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Require Import HoTT.Tactics.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 5
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Modalities *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter Modality@{u a} : Type2@{u a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 10
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** These are the same as for a reflective subuniverse. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 14
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter O_reflector@{u a i} : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 15
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter In@{u a i} : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 18
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter O_inO@{u a i} : forall (O : Modality@{u a}) (T : Type@{i}),
                               In@{u a i} O (O_reflector@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 21
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter to@{u a i} : forall (O : Modality@{u a}) (T : Type@{i}),
                   T -&gt; O_reflector@{u a i} O T.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 24
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter inO_equiv_inO@{u a i j k} :
      forall (O : Modality@{u a}) (T : Type@{i}) (U : Type@{j})
             (T_inO : In@{u a i} O T) (f : T -&gt; U) (feq : IsEquiv f),
        (** We add an extra universe parameter that's bigger than both [i] and [j].  This seems to be necessary for the proof of repleteness in some examples, such as easy modalities. *)
        let gei := ((fun x =&gt; x) : Type@{i} -&gt; Type@{k}) in
        let gej := ((fun x =&gt; x) : Type@{j} -&gt; Type@{k}) in
        In@{u a j} O U.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 32
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter hprop_inO@{u a i}
  : Funext -&gt; forall (O : Modality@{u a}) (T : Type@{i}),
                IsHProp (In@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 36
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Now instead of [extendable_to_O], we have an ordinary induction principle. *)

  (** Unfortunately, we have to define these parameters as [_internal] versions and redefine them later.  This is because eventually we want the [In] fields of [O_ind] and [O_ind_beta] to refer to the [In] typeclass defined for [ReflectiveSubuniverse]s, but in order to prove that modalities *are* reflective subuniverses we need to already have [O_ind] and [O_ind_beta]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 41
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Parameter O_ind_internal@{u a i j k}
  : forall (O : Modality@{u a})
           (A : Type2le@{i a})
           (B : O_reflector@{u a i} O A -&gt; Type2le@{j a})
           (B_inO : forall oa, In@{u a j} O (B oa)),
      (** We add an extra unused universe parameter [k] that's [&gt;= max(i,j)].  This seems to be necessary for some examples, such as [Nullification], which are constructed by way of an operation that requires such a universe.  *)
      let gei := ((fun x =&gt; x) : Type@{i} -&gt; Type@{k}) in
      let gej := ((fun x =&gt; x) : Type@{j} -&gt; Type@{k}) in
      (forall a, B (to O A a)) -&gt; forall a, B a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 49
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

  Parameter O_ind_beta_internal@{u a i j k}
  : forall (O : Modality@{u a})
           (A : Type@{i}) (B : O_reflector O A -&gt; Type@{j})
           (B_inO : forall oa, In@{u a j} O (B oa))
           (f : forall a : A, B (to O A a)) (a:A),
      O_ind_internal@{u a i j k} O A B B_inO f (to O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 56
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter minO_paths@{u a i}
  : forall (O : Modality@{u a})
           (A : Type2le@{i a}) (A_inO : In@{u a i} O A) (z z' : A),
      In@{u a i} O (z = z').</pre>
</div>
<div class="code" title="File: Modality.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 63
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modalities are reflective subuniverses *)

(** We show that modalities have underlying reflective subuniverses.  It is important in some applications, such as [Trunc], that this construction uses the general [O_ind] given as part of the modality data.  For instance, this ensures that [O_functor] reduces to simply an application of [O_ind].

  Note also that our choice of how to define reflective subuniverses differently from the book, using [ooExtendableAlong] enables us to prove this without using funext. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 70
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Modalities_to_ReflectiveSubuniverses
       (Os : Modalities) &lt;: ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Import Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 73
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Fixpoint O_extendable@{u a i j k} (O : Modality@{u a})
           (A : Type@{i}) (B : O_reflector O A -&gt; Type@{j})
           (B_inO : forall a, In@{u a j} O (B a)) (n : nat)
  : ExtendableAlong@{i i j k} n (to O A) B.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 78
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 79
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    destruct n as [|n].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact tt.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 82
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> split.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 82
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (O_ind_internal@{u a i j k} O A B B_inO g); intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 84
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply O_ind_beta_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 85
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply O_extendable; intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 87
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
        apply minO_paths; trivial.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 88
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition ReflectiveSubuniverse := Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector@{u a i} := O_reflector@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3807 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 95
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition In@{u a i} : forall (O : ReflectiveSubuniverse@{u a}),
                   Type2le@{i a} -&gt; Type2le@{i a}
    := In@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_inO@{u a i} : forall (O : ReflectiveSubuniverse@{u a}) (T : Type@{i}),
                               In@{u a i} O (O_reflector@{u a i} O T)
    := O_inO@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to@{u a i} := to@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 101
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Definition inO_equiv_inO@{u a i j k} :
      forall (O : ReflectiveSubuniverse@{u a}) (T : Type@{i}) (U : Type@{j})
             (T_inO : In@{u a i} O T) (f : T -&gt; U) (feq : IsEquiv f),
        In@{u a j} O U
    := inO_equiv_inO@{u a i j k}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition hprop_inO@{u a i}
  : Funext -&gt; forall (O : ReflectiveSubuniverse@{u a}) (T : Type@{i}),
                IsHProp (In@{u a i} O T)
    := hprop_inO@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Corollary 7.7.8, part 1 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 113
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Definition extendable_to_O@{u a i j k} (O : ReflectiveSubuniverse@{u a})
             {P : Type2le@{i a}} {Q : Type2le@{j a}} {Q_inO : In@{u a j} O Q}
  : ooExtendableAlong@{i i j k} (to O P) (fun _ =&gt; Q)
    := fun n =&gt; O_extendable O P (fun _ =&gt; Q) (fun _ =&gt; Q_inO) n.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 116
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

End Modalities_to_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** Conversely, if a reflective subuniverse is closed under sigmas, it is a modality.  This is a bit annoying to state using modules, and in fact with our current definitions there doesn't seem to be a way to actually convince Coq to accept it.  However, this is not really a problem in practice: in most or all examples, constructing [O_ind] directly is just as easy, and preferable because it sometimes gives a judgmental computation rule.  However, for the sake of completeness, we include here the code that almost works. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 122
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type SigmaClosed (Os : ReflectiveSubuniverses).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 122
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Import Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 124
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Parameter inO_sigma@{u a i j k}
  : forall (O : ReflectiveSubuniverse@{u a})
           (A:Type@{i}) (B:A -&gt; Type@{j})
           (A_inO : In@{u a i} O A)
           (B_inO : forall a, In@{u a j} O (B a)),
      In@{u a k} O {x:A &amp; B x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 131
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End SigmaClosed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 133
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We omit the module type, because Coq won't actually accept it (see below for why). *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 135
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module ReflectiveSubuniverses_to_Modalities
       (Os : ReflectiveSubuniverses) (OsSigma : SigmaClosed Os).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 136
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
(** &lt;: Modalities. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 139
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Import Os OsSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 139
Time: 0.044s">
<div class="time" style="width: 8.7301587301587%"></div>
<pre>
  Module Import Os_Theory := ReflectiveSubuniverses_Theory Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality := ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 142
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector@{u a i} := O_reflector@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 144
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3807 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 146
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition In@{u a i} := In@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 146
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_inO@{u a i} := @O_inO@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 147
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to@{u a i} := to@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 148
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition inO_equiv_inO@{u a i j k} := @inO_equiv_inO@{u a i j k}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 149
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition hprop_inO@{u a i} := hprop_inO@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The reason Coq won't actually accept this as a module of type [Modalities] is that the following definitions of [O_ind_internal] and [O_ind_beta_internal] have an extra universe parameter [k] that's at least as large as both [i] and [j].  This is because [extendable_to_O] has such a parameter, which in turn is because [ooExtendableAlong] does.  Unfortunately, we can't directly instantiate [k] to [max(i,j)] because Coq doesn't allow "algebraic universes" in arbitrary position.  We could probably work around it by defining [ExtendableAlong] inductively rather than recursively, but given the non-usefulness of this construction in practice, that doesn't seem to be worth the trouble at the moment. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 153
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Definition O_ind_internal@{u a i j k} (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, In@{u a j} O (B oa))
  : (forall a, B (to O A a)) -&gt; forall a, B a
  := fun g =&gt; pr1 ((O_ind_from_inO_sigma@{u a i j j k k} O (inO_sigma O))
                     A B B_inO g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 158
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>

  Definition O_ind_beta_internal@{u a i j k} (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, In@{u a j} O (B oa))
             (f : forall a : A, B (to O A a)) (a:A)
  : O_ind_internal O A B B_inO f (to O A a) = f a
  := pr2 ((O_ind_from_inO_sigma@{u a i j j k k} O (inO_sigma O))
                     A B B_inO f) a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 166
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition minO_paths@{u a i} (O : Modality@{u a})
             (A : Type@{i}) (A_inO : In@{u a i} O A) (z z' : A)
  : In O (z = z')
  := @inO_paths@{u a i i} O A A_inO z z'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 171
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End ReflectiveSubuniverses_to_Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 173
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Easy modalities *)

(** Our definition of modality is slightly different from the one in the book, which requires an induction principle only into families of the form [fun oa =&gt; O (B oa)], and similarly only that path-spaces of types [O A] are modal, where "modal" means that the unit is an equivalence.  This is equivalent, roughly since every modal type [A] (in this sense) is equivalent to [O A].

However, our definition is more convenient in formalized applications because in some examples (such as [Trunc] and closed modalities), there is a naturally occurring [O_ind] into all modal types that is not judgmentally equal to the one that can be constructed by passing through [O] and back again.  Thus, when we apply general theorems about modalities to a particular modality such as [Trunc], the proofs will reduce definitionally to "the way we would have proved them directly" if we didn't know about general modalities.

On the other hand, in other examples (such as [~~] and open modalities) it is easier to construct the latter weaker induction principle.  Thus, we now show how to get from that to our definition of modality. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 183
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type EasyModalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 183
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter Modality@{u a} : Type2@{u a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 185
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter O_reflector@{u a i} : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 188
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter to@{u a i} : forall (O : Modality@{u a}) (T : Type@{i}),
                   T -&gt; O_reflector@{u a i} O T.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 191
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Parameter O_indO@{u a i j}
  : forall (O : Modality@{u a}) (A : Type@{i})
           (B : O_reflector@{u a i} O A -&gt; Type@{j}),
      (forall a, O_reflector@{u a j} O (B (to O A a)))
      -&gt; forall z, O_reflector@{u a j} O (B z).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 197
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

  Parameter O_indO_beta@{u a i j}
  : forall (O : Modality@{u a}) (A : Type@{i})
           (B : O_reflector@{u a i} O A -&gt; Type@{j})
           (f : forall a, O_reflector@{u a j} O (B (to O A a))) a,
      O_indO O A B f (to O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 203
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Parameter minO_pathsO@{u a i}
  : forall (O : Modality@{u a}) (A : Type@{i})
           (z z' : O_reflector@{u a i} O A),
      IsEquiv (to@{u a i} O (z = z')).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 208
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End EasyModalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 210
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Module EasyModalities_to_Modalities (Os : EasyModalities)
&lt;: Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 213
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Import Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality := Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 217
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3807 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 219
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_reflector@{u a i} := O_reflector@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 219
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to@{u a i} := to@{u a i}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 220
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition In@{u a i}
  : forall (O : Modality@{u a}), Type@{i} -&gt; Type@{i}
  := fun O A =&gt; IsEquiv@{i i} (to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 224
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition hprop_inO@{u a i} `{Funext} (O : Modality@{u a})
             (T : Type@{i})
  : IsHProp (In@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold In.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 230
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    exact (hprop_isequiv (to O T)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 231
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 232
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Definition O_ind_internal@{u a i j k} (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, In@{u a j} O (B oa))
  : let gei := ((fun x =&gt; x) : Type@{i} -&gt; Type@{k}) in
    let gej := ((fun x =&gt; x) : Type@{j} -&gt; Type@{k}) in
    (forall a, B (to O A a)) -&gt; forall oa, B oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 240
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simpl; intros f oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 241
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (H := B_inO oa); unfold In in H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 242
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ((to O (B oa))^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 243
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_indO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 244
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a; apply to, f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 245
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 246
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Definition O_ind_beta_internal@{u a i j k} (O : Modality@{u a})
             (A : Type@{i}) (B : O_reflector@{u a i} O A -&gt; Type@{j})
             (B_inO : forall oa, In@{u a j} O (B oa))
             (f : forall a : A, B (to O A a)) (a:A)
  : O_ind_internal@{u a i j k} O A B B_inO f (to O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold O_ind_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 255
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply @O_indO_beta with (f := fun x =&gt; to O _ (f x)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 256
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 257
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_inO@{u a i} (O : Modality@{u a}) (A : Type@{i})
  : In@{u a i} O (O_reflector@{u a i} O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 260
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 261
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    refine (isequiv_adjointify (to O (O_reflector O A))
             (O_indO O (O_reflector O A) (fun _ =&gt; A) idmap) _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 264
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> intros x; pattern x; apply O_ind_internal.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 264
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 265
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros oa; apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 265
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a; apply ap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 266
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
        exact (O_indO_beta O (O_reflector O A) (fun _ =&gt; A) idmap a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (O_indO_beta O (O_reflector O A) (fun _ =&gt; A) idmap a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 269
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 270
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It seems to be surprisingly hard to show repleteness (without univalence).  We basically have to manually develop enough functoriality of [O] and naturality of [to O]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_equiv_inO@{u a i j k} (O : Modality@{u a}) (A : Type@{i}) (B : Type@{j})
    (A_inO : In@{u a i} O A) (f : A -&gt; B) (feq : IsEquiv f)
  : In@{u a j} O B.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 275
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 276
Time: 0.025s">
<div class="time" style="width: 4.9603174603175%"></div>
<pre>
    simple refine (isequiv_commsq (to O A) (to O B) f
             (O_ind_internal O A (fun _ =&gt; O_reflector O B) _ (fun a =&gt; to O B (f a))) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 278
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros; apply O_inO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 280
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a; refine (O_ind_beta_internal@{u a i j k} O A (fun _ =&gt; O_reflector O B) _ _ a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 280
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 281
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply A_inO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 281
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 282
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> simple refine (isequiv_adjointify _
               (O_ind_internal O B (fun _ =&gt; O_reflector O A) _ (fun b =&gt; to O A (f^-1 b))) _ _);
        intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 284
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_inO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 286
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> pattern x; refine (O_ind_internal O B _ _ _ x); intros.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 287
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 287
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 288
Time: 0.016s">
<div class="time" style="width: 3.1746031746032%"></div>
<pre> simpl; abstract (repeat rewrite O_ind_beta_internal; apply ap, eisretr).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 289
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> pattern x; refine (O_ind_internal O A _ _ _ x); intros.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 289
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 290
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 290
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Modality.v
Line: 291
Time: 0.011s">
<div class="time" style="width: 2.1825396825397%"></div>
<pre> simpl; abstract (repeat rewrite O_ind_beta_internal; apply ap, eissect).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 291
Time: 0.011s">
<div class="time" style="width: 2.1825396825397%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 292
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition minO_paths@{u a i} (O : Modality@{u a})
             (A : Type@{i}) (A_inO : In@{u a i} O A) (a a' : A)
  : In@{u a i} O (a = a').</pre>
</div>
<div class="code" title="File: Modality.v
Line: 296
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 297
Time: 0.017s">
<div class="time" style="width: 3.3730158730159%"></div>
<pre>
    simple refine (inO_equiv_inO O (to O A a = to O A a') _ _
                          (@ap _ _ (to O A) a a')^-1 _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply minO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (@isequiv_ap _ _ _ A_inO _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isequiv_inverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 303
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

End EasyModalities_to_Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 305
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We now move on to the general theory of modalities. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Modalities_Theory (Os : Modalities).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Export Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 310
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
Module Export Os_ReflectiveSubuniverses
  := Modalities_to_ReflectiveSubuniverses Os.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 312
Time: 0.047s">
<div class="time" style="width: 9.3253968253968%"></div>
<pre>
Module Export RSU
  := ReflectiveSubuniverses_Theory Os_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 314
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** As with reflective subuniverses, we put this in a module so it can be exported separately (and it should be). *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 316
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Export Coercions.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 316
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Coercion modality_to_reflective_subuniverse
    := idmap : Modality -&gt; ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
End Coercions.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 319
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** As promised, we redefine [O_ind] and [O_ind_beta] so that their [In] hypotheses refer to the typeclass [RSU.In]. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 321
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>Definition O_ind@{u a i j e0 e1 e2} {O : Modality@{u a}}
           {A : Type@{i}} (B : O A -&gt; Type@{j})
           {B_inO : forall oa, In O (B oa)}
           (f : forall a, B (to O A a)) (oa : O A)
: B oa
:= O_ind_internal@{u a e0 e1 e2} O A B B_inO f oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 326
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>

Definition O_ind_beta {O : Modality@{u a}}
           {A : Type@{i}} (B : O A -&gt; Type@{j})
           {B_inO : forall oa, In O (B oa)}
           (f : forall a : A, B (to O A a)) (a : A)
: @O_ind O A B B_inO f (to O A a) = f a
:= O_ind_beta_internal O A B B_inO f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 333
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Corollary 7.7.8, part 2 *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 335
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance inO_sigma {O : Modality} (A:Type) (B:A -&gt; Type)
       `{In O A} `{forall a, In O (B a)}
: In O {x:A &amp; B x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 337
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 338
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize dependent A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 339
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  refine (inO_sigma_from_O_ind _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 340
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros A B ? g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 341
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  exists (O_ind B g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 342
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply O_ind_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 343
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 344
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This has useful consequences like closure under [Equiv]. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 346
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance inO_equiv `{Funext} {O : Modality} (A B : Type)
       `{In O A} `{In O B}
: In O (A &lt;~&gt; B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 348
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 349
Time: 0.083s">
<div class="time" style="width: 16.468253968254%"></div>
<pre>
  refine (inO_equiv_inO _ (issig_equiv A B)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 350
Time: 0.021s">
<div class="time" style="width: 4.1666666666667%"></div>
<pre>
  refine (inO_sigma _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 351
Time: 0.504s">
<div class="time" style="width: 100%"></div>
<pre>
  intros f; refine (inO_equiv_inO _ (issig_isequiv f)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 352
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 353
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Theorem 7.3.9: The reflector [O] can be discarded inside a reflected sum. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 355
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition equiv_O_sigma_O {O : Modality} {A} (P : A -&gt; Type)
: O {x:A &amp; O (P x)} &lt;~&gt; O {x:A &amp; P x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 356
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  simple refine (equiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 358
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 359
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre> apply O_rec; intros [a op]; revert op.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 359
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    apply O_rec; intros p.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 360
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (to O _ (a;p)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 361
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 362
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre> apply O_rec; intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 362
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (to O _ (a ; to O _ p)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 363
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 364
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre> unfold Sect; apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 364
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    intros [a p]; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 365
Time: 0.025s">
<div class="time" style="width: 4.9603174603175%"></div>
<pre>
    abstract (repeat rewrite O_rec_beta; reflexivity).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 366
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 367
Time: 0.012s">
<div class="time" style="width: 2.3809523809524%"></div>
<pre> unfold Sect; apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 367
Time: 0.009s">
<div class="time" style="width: 1.7857142857143%"></div>
<pre>
    intros [a op]; revert op; apply O_ind; try exact _; intros p; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 368
Time: 0.03s">
<div class="time" style="width: 5.952380952381%"></div>
<pre>
    abstract (repeat rewrite O_rec_beta; reflexivity).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 369
Time: 0.024s">
<div class="time" style="width: 4.7619047619048%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Corollary 7.3.10 *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 372
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Corollary equiv_sigma_inO_O {O : Modality} {A} `{In O A} (P : A -&gt; Type)
: {x:A &amp; O (P x)} &lt;~&gt; O {x:A &amp; P x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 373
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 374
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  transitivity (O {x:A &amp; O (P x)}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 375
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 376
Time: 0.01s">
<div class="time" style="width: 1.984126984127%"></div>
<pre> apply equiv_to_O; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 376
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 377
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> apply equiv_O_sigma_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 377
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 378
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The induction principle [O_ind], like most induction principles, is an equivalence. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 380
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section OIndEquiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 380
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {fs : Funext} (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 381
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section OIndEquivData.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 383
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

    Context {A : Type} (B : O A -&gt; Type) `{forall a, In O (B a)}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 385
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

    Global Instance isequiv_O_ind : IsEquiv (O_ind B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 387
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 388
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      apply isequiv_adjointify with (g := fun h =&gt; h oD to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 389
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 390
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 390
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 390
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre>
        refine (O_ind (fun oa =&gt; O_ind B (h oD to O A) oa = h oa) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 391
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
        exact (O_ind_beta B (h oD to O A)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 392
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 393
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 393
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 393
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
        exact (O_ind_beta B f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 394
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 395
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

    Definition equiv_O_ind
    : (forall a, B (to O A a)) &lt;~&gt; (forall oa, B oa)
    := BuildEquiv _ _ (O_ind B) _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 399
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Theorem 7.7.7 *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 402
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>Definition isequiv_oD_to_O
    : IsEquiv (fun (h : forall oa, B oa) =&gt; h oD to O A)
    := equiv_isequiv equiv_O_ind^-1.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 404
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  End OIndEquivData.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 406
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre>

  Local Definition isequiv_o_to_O (A B : Type) (B_inO : In O B)
  : IsEquiv (fun (h : O A -&gt; B) =&gt; h o to O A)
    := isequiv_oD_to_O (fun _ =&gt; B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 410
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>

End OIndEquiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 412
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected types *)

(** Connectedness of a type, relative to a modality, can be defined in two equivalent ways: quantifying over all maps into modal types, or by considering just the universal case, the modal reflection of the type itself.  The former requires only core Coq, but blows up the size (universe level) of [IsConnected], since it quantifies over types; moreover, it is not even quite correct since (at least with a polymorphic modality) it should really be quantified over all universes.  Thus, we use the latter, although in most examples it requires HITs to define the modal reflection.

Question: is there a definition of connectedness (say, for n-types) that neither blows up the universe level, nor requires HIT's? *)

(** We give annotations to reduce the number of universe parameters. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 420
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Class IsConnected (O : Modality@{u a}) (A : Type@{i})
  (** Since [Contr] is a [Notation], we can't annotate it for universes (see https://coq.inria.fr/bugs/show_bug.cgi?id=3825); thus we write [IsTrunc -2] explicitly instead. *)
  := isconnected_contr_O : IsTrunc@{i} -2 (O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 422
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Check IsConnected@{u a i}.

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 424
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Existing Instance isconnected_contr_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 424
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedTypes.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Universes Ou Oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 427
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality@{Ou Oa}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 431
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_isconnected `{Funext} A
  : IsHProp (IsConnected O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 432
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 433
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    unfold IsConnected; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 434
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 435
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything equivalent to a connected type is connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 438
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_equiv (A : Type) {B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnected O A -&gt; IsConnected O B.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 439
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 440
Time: 0.014s">
<div class="time" style="width: 2.7777777777778%"></div>
<pre>
    intros ?; refine (contr_equiv (O A) (O_functor O f)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 441
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 442
Time: 0.004s">
<div class="time" style="width: 0.79365079365079%"></div>
<pre>

  Definition isconnected_equiv' (A : Type) {B : Type} (f : A &lt;~&gt; B)
  : IsConnected O A -&gt; IsConnected O B
    := isconnected_equiv A f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 446
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connectedness of a type [A] can equivalently be characterized by the fact that any map to an [O]-type [C] is nullhomotopic.  Here is one direction of that equivalence. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 449
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition isconnected_elim {A : Type} `{IsConnected O A} (C : Type) `{In O C} (f : A -&gt; C)
  : NullHomotopy f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 450
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 451
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    set (ff := @O_rec O _ _ _ f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 452
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    exists (ff (center _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 454
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> symmetry.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 454
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    refine (ap ff (contr (to O _ a)) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 455
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_rec_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 456
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 457
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** For the other direction of the equivalence, it's sufficient to consider the case when [C] is [O A]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 460
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_from_elim_to_O {A : Type}
  : NullHomotopy (to O A) -&gt; IsConnected O A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 461
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 462
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros nh.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 463
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (nh .1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 464
Time: 0.004s">
<div class="time" style="width: 0.79365079365079%"></div>
<pre>
    apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 465
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    intros; symmetry; apply (nh .2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 466
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 467
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Now the general case follows. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_from_elim {A : Type}
  : (forall (C : Type) `{In O C} (f : A -&gt; C), NullHomotopy f)
    -&gt; IsConnected O A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 472
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 473
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 474
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    exact (isconnected_from_elim_to_O (H (O A) _ (to O A))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 475
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 476
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connected types are closed under sigmas. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 479
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance isconnected_sigma {A : Type} {B : A -&gt; Type}
             `{IsConnected O A} `{forall a, IsConnected O (B a)}
  : IsConnected O {a:A &amp; B a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 481
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 482
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isconnected_from_elim; intros C ? f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 483
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    pose (nB := fun a =&gt; @isconnected_elim (B a) _ C _ (fun b =&gt; f (a;b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 484
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    pose (nA := isconnected_elim C (fun a =&gt; (nB a).1)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 485
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    exists (nA.1); intros [a b].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 486
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact ((nB a).2 b @ nA.2 a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 487
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 488
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Contractible types are connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 491
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance isconnected_contr {A : Type} `{Contr A}
    : IsConnected O A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 492
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 493
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply contr_O_contr; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 494
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 495
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>    

  (** A type which is both connected and truncated is contractible. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 498
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition contr_trunc_conn {A : Type} `{In O A} `{IsConnected O A}
  : Contr A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 499
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 500
Time: 0.009s">
<div class="time" style="width: 1.7857142857143%"></div>
<pre>
    apply (contr_equiv _ (to O A)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 501
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 502
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Here's another way of stating the universal property for mapping out of connected types into modal ones. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 505
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition extendable_const_isconnected_inO@{i j k l m} (n : nat)
             (** Work around https://coq.inria.fr/bugs/show_bug.cgi?id=3811 *)
             (A : Type@{i}) {conn_A : IsConnected@{Ou Oa i} O A}
             (C : Type@{j}) `{In@{Ou Oa j} O C}
  : ExtendableAlong@{i i j j} n (@const@{i i} A Unit tt) (fun _ =&gt; C).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 509
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 510
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    generalize dependent C;
      simple_induction n n IHn; intros C ?;
      [ exact tt | split ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 513
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 514
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      exists (fun _ : Unit =&gt; (isconnected_elim@{i j j k i} C f).1); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 515
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      symmetry; apply ((isconnected_elim@{i j j k i} C f).2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 516
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 517
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 517
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      refine (extendable_postcompose'@{i i j j j j l l l l} n _ _ _ _ (IHn (h tt = k tt) (inO_paths@{Ou Oa j m} _ _ _ _))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 518
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros []; apply equiv_idmap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 519
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 520
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Definition ooextendable_const_isconnected_inO@{i j k}
             (A : Type@{i}) `{IsConnected@{Ou Oa i} O A}
             (C : Type@{j}) `{In@{Ou Oa j} O C}
  : ooExtendableAlong (@const A Unit tt) (fun _ =&gt; C)
    := fun n =&gt; extendable_const_isconnected_inO@{i j k k j} n A C.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 526
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Definition isequiv_const_isconnected_inO `{Funext}
             {A : Type} `{IsConnected O A} (C : Type) `{In O C}
  : IsEquiv (@const A C).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 530
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 531
Time: 0.004s">
<div class="time" style="width: 0.79365079365079%"></div>
<pre>
    refine (@isequiv_compose _ _ (fun c u =&gt; c) _ _ _
              (isequiv_ooextendable (fun _ =&gt; C) (@const A Unit tt)
                                    (ooextendable_const_isconnected_inO A C))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 534
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 535
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>

End ConnectedTypes.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 537
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally truncated maps *)

(** A map is "in [O]" if each of its fibers is. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 542
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Class MapIn (O : Modality@{u a}) {A : Type@{i}} {B : Type@{j}} (f : A -&gt; B)
  := inO_hfiber_ino_map : forall (b:B), In@{u a k} O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 543
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Check MapIn@{u a i j k}.        (** k &gt;= max(i,j) *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 545
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Existing Instance inO_hfiber_ino_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 545
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ModalMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 547
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 548
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance mapinO_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 552
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 553
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 554
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (fcontr_isequiv f _ b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 555
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 556
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 557
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any map between modal types is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 560
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance mapinO_between_inO {A B : Type} (f : A -&gt; B)
             `{In O A} `{In O B}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 562
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 563
Time: 0.019s">
<div class="time" style="width: 3.7698412698413%"></div>
<pre>
    intros b; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 564
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 565
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a modal map is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 568
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition mapinO_homotopic {A B : Type} (f : A -&gt; B) {g : A -&gt; B}
             (p : f == g) `{MapIn O _ _ f}
  : MapIn O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 570
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 571
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 572
Time: 0.019s">
<div class="time" style="width: 3.7698412698413%"></div>
<pre>
    refine (inO_equiv_inO (hfiber f b)
                          (equiv_hfiber_homotopic f g p b)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 574
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 575
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being modal is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 578
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_mapinO `{Funext} {A B : Type} (f : A -&gt; B)
  : IsHProp (MapIn O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 579
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 580
Time: 0.011s">
<div class="time" style="width: 2.1825396825397%"></div>
<pre>
    apply trunc_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 581
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 582
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The composite of modal maps is modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 585
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Global Instance mapinO_compose {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{MapIn O _ _ f} `{MapIn O _ _ g}
  : MapIn O (g o f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 587
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 588
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 589
Time: 0.429s">
<div class="time" style="width: 85.119047619048%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_compose f g c)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 590
Time: 0.025s">
<div class="time" style="width: 4.9603174603175%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 591
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The projection from the sum of a family of modal types is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 594
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance mapinO_pr1 {A : Type} (P : A -&gt; Type)
         `{forall a, In O (P a)}
  : MapIn O (@pr1 A P).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 596
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 597
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 598
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
    exact (inO_equiv_inO (P a) (hfiber_fibration a P)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 599
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 600
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A slightly specialized result: if [Empty] is modal, then a map with decidable hprop fibers (such as [inl] or [inr]) is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 603
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance mapinO_hfiber_decidable_hprop {A B : Type} (f : A -&gt; B)
         `{In O Empty}
         `{forall b, IsHProp (hfiber f b)}
         `{forall b, Decidable (hfiber f b)}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 607
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 608
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 609
Time: 0.004s">
<div class="time" style="width: 0.79365079365079%"></div>
<pre>
    destruct (equiv_decidable_hprop (hfiber f b)) as [e|e].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 610
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 611
Time: 0.007s">
<div class="time" style="width: 1.3888888888889%"></div>
<pre> exact (inO_equiv_inO Unit e^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 611
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 612
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre> exact (inO_equiv_inO Empty e^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 612
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 613
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Modal maps cancel on the left *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 616
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Definition cancelL_mapinO {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
  : MapIn O g -&gt; MapIn O (g o f) -&gt; MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 617
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 618
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros ? ? b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 619
Time: 0.053s">
<div class="time" style="width: 10.515873015873%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_hfiber_compose_map f g b)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 620
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 621
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The pullback of a modal map is modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 624
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance mapinO_pullback {A B C}
         (f : B -&gt; A) (g : C -&gt; A) `{MapIn O _ _ g}
  : MapIn O (f^* g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 626
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 627
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 628
Time: 0.037s">
<div class="time" style="width: 7.3412698412698%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_pullback_along f g b)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 629
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 630
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Global Instance mapinO_pullback' {A B C}
         (g : C -&gt; A) (f : B -&gt; A) `{MapIn O _ _ f}
  : MapIn O (g^*' f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 634
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 635
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 636
Time: 0.039s">
<div class="time" style="width: 7.7380952380952%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_pullback_along' g f c)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 637
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 638
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** [functor_sum] preserves modal maps. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 641
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Global Instance mapinO_functor_sum {A A' B B'}
         (f : A -&gt; A') (g : B -&gt; B') `{MapIn O _ _ f} `{MapIn O _ _ g}
  : MapIn O (functor_sum f g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 643
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 644
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a|b].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 645
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 646
Time: 0.076s">
<div class="time" style="width: 15.079365079365%"></div>
<pre> refine (inO_equiv_inO _ (hfiber_functor_sum_l f g a)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 646
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 647
Time: 0.076s">
<div class="time" style="width: 15.079365079365%"></div>
<pre> refine (inO_equiv_inO _ (hfiber_functor_sum_r f g b)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 647
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 648
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** So does [unfunctor_sum], if both summands are preserved.  These can't be [Instance]s since they require [Ha] and [Hb] to be supplied. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 651
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>Definition mapinO_unfunctor_sum_l {A A' B B'}
         (h : A + B -&gt; A' + B')
         (Ha : forall a:A, is_inl (h (inl a)))
         (Hb : forall b:B, is_inr (h (inr b)))
         `{MapIn O _ _ h}
  : MapIn O (unfunctor_sum_l h Ha).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 656
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 657
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 658
Time: 0.124s">
<div class="time" style="width: 24.603174603175%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_unfunctor_sum_l h Ha Hb a)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 659
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 660
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>

  Definition mapinO_unfunctor_sum_r {A A' B B'}
         (h : A + B -&gt; A' + B')
         (Ha : forall a:A, is_inl (h (inl a)))
         (Hb : forall b:B, is_inr (h (inr b)))
         `{MapIn O _ _ h}
  : MapIn O (unfunctor_sum_r h Hb).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 667
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 668
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 669
Time: 0.136s">
<div class="time" style="width: 26.984126984127%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_unfunctor_sum_r h Ha Hb b)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 670
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 671
Time: 0.009s">
<div class="time" style="width: 1.7857142857143%"></div>
<pre>

End ModalMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 673
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected maps *)

(** Connectedness of a map can again be defined in two equivalent ways: by connectedness of its fibers (as types), or by the lifting property/elimination principle against truncated types.  We use the former; the equivalence with the latter is given below in [conn_map_elim], [conn_map_comp], and [conn_map_from_extension_elim]. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 678
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Class IsConnMap (O : Modality@{u a})
      {A : Type@{i}} {B : Type@{j}} (f : A -&gt; B)
  := isconnected_hfiber_conn_map
     (** The extra universe [k] is &gt;= max(i,j). *)
     : forall b:B, IsConnected@{u a k} O (hfiber@{i j} f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 682
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Check IsConnMap@{u a i j k}.

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 684
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Existing Instance isconnected_hfiber_conn_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 684
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 686
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{Univalence} `{Funext}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 687
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 688
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is connected *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 691
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance conn_map_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 692
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 693
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 694
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (fcontr_isequiv f _ b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 695
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
    unfold IsConnected; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 696
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 697
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a connected map is connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 700
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition conn_map_homotopic {A B : Type} (f g : A -&gt; B) (h : f == g)
  : IsConnMap O f -&gt; IsConnMap O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 701
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 702
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros ? b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 703
Time: 0.017s">
<div class="time" style="width: 3.3730158730159%"></div>
<pre>
    exact (isconnected_equiv O (hfiber f b)
                             (equiv_hfiber_homotopic f g h b) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 705
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 706
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The pullback of a connected map is connected *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 709
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance conn_map_pullback {A B C}
         (f : B -&gt; A) (g : C -&gt; A) `{IsConnMap O _ _ g}
  : IsConnMap O (f^* g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 711
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 712
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 713
Time: 0.037s">
<div class="time" style="width: 7.3412698412698%"></div>
<pre>
    refine (isconnected_equiv _ _ (hfiber_pullback_along f g b)^-1 _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 714
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 715
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Global Instance conn_map_pullback' {A B C}
         (g : C -&gt; A) (f : B -&gt; A) `{IsConnMap O _ _ f}
  : IsConnMap O (g^*' f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 719
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 720
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 721
Time: 0.038s">
<div class="time" style="width: 7.5396825396825%"></div>
<pre>
    refine (isconnected_equiv _ _ (hfiber_pullback_along' g f c)^-1 _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 722
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 723
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The projection from a family of connected types is connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 726
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance conn_map_pr1 {A : Type} {B : A -&gt; Type}
         `{forall a, IsConnected O (B a)}
  : IsConnMap O (@pr1 A B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 728
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 729
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 730
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
    refine (isconnected_equiv O (B a) (hfiber_fibration a B) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 731
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 732
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 735
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_isconnmap `{Funext} {A B : Type} (f : A -&gt; B)
  : IsHProp (IsConnMap O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 736
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 737
Time: 0.008s">
<div class="time" style="width: 1.5873015873016%"></div>
<pre>
    apply trunc_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 738
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 739
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** n-connected maps are orthogonal to n-truncated maps (i.e. familes of n-truncated types). *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 742
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ConnMapElim.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 742
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    Context {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
            (P : B -&gt; Type) {HP : forall b:B, In O (P b)}
            (d : forall a:A, P (f a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 745
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

    Let fibermap (b : B) : hfiber f b -&gt; P b
      := fun x =&gt; transport P x.2 (d x.1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 748
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

    Let g (b : B) : {c : P b &amp; forall a, fibermap b a = c}
      := isconnected_elim O (P b) (fibermap b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 751
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition conn_map_elim (b : B) : P b
      := (g b).1.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 754
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition conn_map_comp (a : A) : conn_map_elim (f a) = d a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 756
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 757
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold conn_map_elim.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 758
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      change (d a) with (fibermap (f a) (a;1)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 759
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      symmetry.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 760
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ((g (f a)).2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 760
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 761
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End ConnMapElim.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 763
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A map which is both connected and modal is an equivalence. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 766
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition isequiv_conn_ino_map {A B : Type} (f : A -&gt; B)
             `{IsConnMap O _ _ f} `{MapIn O _ _ f}
  : IsEquiv f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 768
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 769
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_fcontr.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 770
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 770
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    apply (contr_trunc_conn O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 771
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 772
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** We can re-express this in terms of extensions. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 775
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Lemma extension_conn_map_elim
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
  : ExtensionAlong f P d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 779
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 780
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 781
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_comp.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 782
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 783
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Definition extendable_conn_map_inO (n : nat)
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : ExtendableAlong n f P.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 788
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 789
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    generalize dependent P.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 790
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    simple_induction n n IHn; intros P ?; [ exact tt | split ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 791
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 792
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> intros d; apply extension_conn_map_elim; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 792
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 793
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre> intros h k; apply IHn; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 793
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 794
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>

  Definition ooextendable_conn_map_inO
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : ooExtendableAlong f P
    := fun n =&gt; extendable_conn_map_inO n f P.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 800
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

  Lemma allpath_extension_conn_map
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
        (e e' : ExtensionAlong f P d)
  : e = e'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 807
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 808
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    apply path_extension.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 809
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre>
    refine (extension_conn_map_elim _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 810
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 811
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It follows that [conn_map_elim] is actually an equivalence. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 814
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Theorem isequiv_o_conn_map
          {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
          (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : IsEquiv (fun (g : forall b:B, P b) =&gt; g oD f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 817
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 818
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_fcontr; intros d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 819
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply contr_inhabited_hprop.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 820
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 821
Time: 0.265s">
<div class="time" style="width: 52.579365079365%"></div>
<pre> refine (@trunc_equiv' {g : forall b, P b &amp; g oD f == d} _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 821
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 822
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> refine (equiv_functor_sigma' (equiv_idmap _) _); intros g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 822
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply equiv_path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 823
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 823
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply hprop_allpath.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 824
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g h.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 824
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      exact (allpath_extension_conn_map f P d g h).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 825
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 826
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 826
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
      apply path_forall; intros x; apply conn_map_comp.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 827
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 828
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Conversely, if a map satisfies this elimination principle (expressed via extensions), then it is connected.  This completes the proof of Lemma 7.5.7 from the book. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 831
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Lemma conn_map_from_extension_elim {A B : Type} (f : A -&gt; B)
  : (forall (P : B -&gt; Type) {P_inO : forall b:B, In O (P b)}
            (d : forall a:A, P (f a)),
       ExtensionAlong f P d)
    -&gt; IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 835
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 836
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros Hf b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 837
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isconnected_from_elim_to_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 837
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre>
    assert (e := Hf (fun b =&gt; O (hfiber f b)) _ (fun a =&gt; to O _ (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 838
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    exists (e.1 b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 839
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 840
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> destruct p.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 840
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    symmetry; apply (e.2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 841
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 842
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Corollary 7.5.8: It follows that the unit maps [to O A] are connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 845
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance conn_map_to_O (A : Type) : IsConnMap O (to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 845
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 846
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 847
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    exists (O_ind P d); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 848
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_ind_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 849
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 850
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.6: Connected maps compose and cancel on the right. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 853
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>Global Instance conn_map_compose {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ g}
  : IsConnMap O (g o f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 855
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 856
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 857
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
    exists (conn_map_elim g P (conn_map_elim f (P o g) d)); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 858
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    exact (conn_map_comp g P _ _ @ conn_map_comp f (P o g) d a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 859
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 860
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

  Definition cancelR_conn_map {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ (g o f)}
  :  IsConnMap O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 864
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 865
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 866
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    exists (conn_map_elim (g o f) P (d oD f)); intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 867
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre>
    pattern b; refine (conn_map_elim f _ _ b); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 868
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    exact (conn_map_comp (g o f) P (d oD f) a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 869
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 870
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (* Lemma 7.5.10: A map to a type in [O] exhibits its codomain as the [O]-reflection of its domain if (and only if) it is [O]-connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 873
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition isequiv_O_rec_conn_map {A B : Type} `{In O B}
             (f : A -&gt; B) `{IsConnMap O _ _ f}
  : IsEquiv (O_rec f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 875
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 876
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_conn_ino_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 877
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 878
Time: 0.06s">
<div class="time" style="width: 11.904761904762%"></div>
<pre> refine (cancelR_conn_map (to O A) (O_rec f)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 878
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (conn_map_homotopic f _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 879
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      intros a; symmetry; apply O_rec_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 880
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 881
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> apply mapinO_between_inO; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 881
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 882
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The constant map to [Unit] is connected just when its domain is. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 885
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_conn_map_to_unit {A : Type}
             `{IsConnMap O _ _ (@const A Unit tt)}
  : IsConnected O A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 887
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 888
Time: 0.019s">
<div class="time" style="width: 3.7698412698413%"></div>
<pre>
    refine (isconnected_equiv O (hfiber (@const A Unit tt) tt)
              (equiv_sigma_contr (fun a:A =&gt; const tt a = tt)) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 890
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 891
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Hint Immediate isconnected_conn_map_to_unit : typeclass_instances.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 893
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Global Instance conn_map_to_unit_isconnected {A : Type}
         `{IsConnected O A}
  : IsConnMap O (@const A Unit tt).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 897
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 898
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros u.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 899
Time: 0.016s">
<div class="time" style="width: 3.1746031746032%"></div>
<pre>
    refine (isconnected_equiv O A
              (equiv_sigma_contr (fun a:A =&gt; const tt a = u))^-1 _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 901
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 902
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.12 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 905
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 905
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

    Context {A B : Type} {P : A -&gt; Type} {Q : B -&gt; Type}
            (f : A -&gt; B) (g : forall a, P a -&gt; Q (f a))
            `{forall a, IsConnMap O (g a)}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 909
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

    Definition equiv_O_hfiber_functor_sigma (b:B) (v:Q b)
    : O (hfiber (functor_sigma f g) (b;v)) &lt;~&gt; O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 912
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 913
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; hfiber (g w.1) ((w.2)^ # v)}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 914
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 915
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre> apply equiv_O_functor, hfiber_functor_sigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 915
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 915
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; O (hfiber (g w.1) ((w.2)^ # v))}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 916
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 917
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre> symmetry; apply equiv_O_sigma_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 917
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 917
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 918
Time: 0.009s">
<div class="time" style="width: 1.7857142857143%"></div>
<pre>
      apply equiv_sigma_contr; intros [a p]; simpl; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 919
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 920
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

    Global Instance conn_map_functor_sigma `{IsConnMap O _ _ f}
    : IsConnMap O (functor_sigma f g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 923
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 924
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [b v].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 925
Time: 0.008s">
<div class="time" style="width: 1.5873015873016%"></div>
<pre>
      refine (contr_equiv' _ (equiv_O_hfiber_functor_sigma b v)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 926
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 927
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

    Definition conn_map_base_inhabited (inh : forall b, Q b)
               `{IsConnMap O _ _ (functor_sigma f g)}
    : IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 931
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 932
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 933
Time: 0.023s">
<div class="time" style="width: 4.5634920634921%"></div>
<pre>
      refine (contr_equiv _ (equiv_O_hfiber_functor_sigma b (inh b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 934
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 935
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>

  End ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 937
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.13.  The "if" direction is a special case of [conn_map_functor_sigma], so we prove only the "only if" direction. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 940
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition conn_map_fiber
             {A : Type} {P Q : A -&gt; Type} (f : forall a, P a -&gt; Q a)
             `{IsConnMap O _ _ (functor_sigma idmap f)}
  : forall a, IsConnMap O (f a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 943
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 944
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a q.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 945
Time: 0.007s">
<div class="time" style="width: 1.3888888888889%"></div>
<pre>
    refine (isconnected_equiv' O (hfiber (functor_sigma idmap f) (a;q)) _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 946
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (hfiber_functor_sigma_idmap P Q f a q).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 947
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 948
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.14: Connected maps are inverted by [O]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 951
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Global Instance O_inverts_conn_map {A B : Type} (f : A -&gt; B)
         `{IsConnMap O _ _ f}
  : IsEquiv (O_functor O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 953
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simple refine (isequiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 955
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 956
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> apply O_rec; intros y.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 956
Time: 0.007s">
<div class="time" style="width: 1.3888888888889%"></div>
<pre>
      exact (O_functor O pr1 (center (O (hfiber f y)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 957
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 958
Time: 0.004s">
<div class="time" style="width: 0.79365079365079%"></div>
<pre> unfold Sect; apply O_ind; try exact _; intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 958
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      refine (ap (O_functor O f) (O_rec_beta _ b) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 959
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      refine ((O_functor_compose _ _ _ _)^ @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 960
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      set (x := (center (O (hfiber f b)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 961
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
      clearbody x; revert x; apply O_ind; try exact _; intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 962
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
      refine (O_rec_beta (to O B o (f o pr1)) (a;p) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 963
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (ap (to O B) p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 964
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 965
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre> unfold Sect; apply O_ind; try exact _; intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 965
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
      refine (ap (O_rec _) (to_O_natural O f a) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 966
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      refine (O_rec_beta _ _ @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 967
Time: 0.004s">
<div class="time" style="width: 0.79365079365079%"></div>
<pre>
      transitivity (O_functor O pr1 (to O (hfiber f (f a)) (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 969
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre> apply ap, contr.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 969
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 970
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> refine (to_O_natural _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 970
Time: 0.021s">
<div class="time" style="width: 4.1666666666667%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 971
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** As a consequence, connected maps between modal types are equivalences. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 974
Time: 0.029s">
<div class="time" style="width: 5.7539682539683%"></div>
<pre>Definition isequiv_conn_map_ino {A B : Type} (f : A -&gt; B)
         `{In O A} `{In O B} `{IsConnMap O _ _ f}
    : IsEquiv f
    := isequiv_commsq' f (O_functor O f) (to O A) (to O B) (to_O_natural O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 977
Time: 0.025s">
<div class="time" style="width: 4.9603174603175%"></div>
<pre>

End ConnectedMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 979
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The modal factorization system *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 982
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ModalFact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 982
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{fs : Funext} (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 983
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.6.4 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 986
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition image {A B : Type} (f : A -&gt; B)
  : Factorization (@IsConnMap O) (@MapIn O) f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 987
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 988
Time: 0.014s">
<div class="time" style="width: 2.7777777777778%"></div>
<pre>
    refine (Build_Factorization {b : B &amp; O (hfiber f b)}
                                (fun a =&gt; (f a ; to O _ (a;1)))
                                pr1
                                (fun a =&gt; 1)
                                _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 993
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 994
Time: 0.114s">
<div class="time" style="width: 22.619047619048%"></div>
<pre> exact (conn_map_compose O
              (equiv_fibration_replacement f)
              (functor_sigma idmap (fun b =&gt; to O (hfiber f b)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 996
Time: 0.004s">
<div class="time" style="width: 0.79365079365079%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 997
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>

  Global Instance conn_map_factor1_image {A B : Type} (f : A -&gt; B)
  : IsConnMap O (factor1 (image f))
    := inclass1 (image f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1001
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>

  Global Instance inO_map_factor1_image {A B : Type} (f : A -&gt; B)
  : MapIn O (factor2 (image f))
    := inclass2 (image f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1005
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** This is the composite of the three displayed equivalences at the beginning of the proof of Lemma 7.6.5.  Note that it involves only a single factorization of [f]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 1008
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>Lemma O_hfiber_O_fact {A B : Type} {f : A -&gt; B}
        (fact : Factorization (@IsConnMap O) (@MapIn O) f) (b : B)
  : O (hfiber (factor2 fact o factor1 fact) b)
      &lt;~&gt; hfiber (factor2 fact) b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1011
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1012
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    refine (_ oE
             (equiv_O_functor O
               (hfiber_compose (factor1 fact) (factor2 fact) b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1015
Time: 0.163s">
<div class="time" style="width: 32.34126984127%"></div>
<pre>
    refine (equiv_sigma_contr (fun w =&gt; O (hfiber (factor1 fact) w.1)) oE _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1016
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1017
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> intros w; exact (inclass1 fact w.1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1017
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1018
Time: 0.056s">
<div class="time" style="width: 11.111111111111%"></div>
<pre> refine ((equiv_sigma_inO_O (fun w =&gt; hfiber (factor1 fact) w.1))^-1)%equiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1018
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (inclass2 fact b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1019
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1020
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** This is the corresponding first three of the displayed "mapsto"s in proof of Lemma 7.6.5, and also the last three in reverse order, generalized to an arbitrary path [p].  Note that it is much harder to prove than in the book, because we are working in the extra generality of a modality where [O_ind_beta] is only propositional. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 1023
Time: 0.091s">
<div class="time" style="width: 18.055555555556%"></div>
<pre>Lemma O_hfiber_O_fact_inverse_beta {A B : Type} {f : A -&gt; B}
        (fact : Factorization (@IsConnMap O) (@MapIn O) f)
        (a : A) (b : B) (p : factor2 fact (factor1 fact a) = b)
  : (O_hfiber_O_fact fact b)^-1
      (factor1 fact a ; p) = to O _ (a ; p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1027
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1028
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    set (g := factor1 fact); set (h := factor2 fact).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1029
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1030
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold O_hfiber_O_fact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1031
Time: 0.074s">
<div class="time" style="width: 14.68253968254%"></div>
<pre>
    ev_equiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1032
Time: 0.007s">
<div class="time" style="width: 1.3888888888889%"></div>
<pre>
    apply moveL_equiv_M.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1033
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre>
    transitivity (existT (fun (w : hfiber h b) =&gt; O (hfiber g w.1))
                         (g a; p) (to O (hfiber g (g a)) (a ; 1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1035
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1036
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre> apply moveR_equiv_V; reflexivity.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1036
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1037
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> apply moveL_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1037
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
      transitivity (to O _ (existT (fun (w : hfiber h b) =&gt; (hfiber g w.1))
                         (g a; p) (a ; 1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1039
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1040
Time: 0.068s">
<div class="time" style="width: 13.492063492063%"></div>
<pre> simpl; repeat rewrite O_rec_beta; reflexivity.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1040
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1041
Time: 0.006s">
<div class="time" style="width: 1.1904761904762%"></div>
<pre> symmetry; apply to_O_natural.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1041
Time: 0.049s">
<div class="time" style="width: 9.7222222222222%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1042
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section TwoFactorizations.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1044
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
    Context {A B : Type} (f : A -&gt; B)
            (fact fact' : Factorization (@IsConnMap O) (@MapIn O) f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1046
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

    Let H := fun x =&gt; fact_factors fact x @ (fact_factors fact' x)^.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1048
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Lemma 7.6.5, part 1. *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 1051
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>Definition equiv_O_factor_hfibers (b:B)
    : hfiber (factor2 fact) b &lt;~&gt; hfiber (factor2 fact') b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1052
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1053
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_hfiber_O_fact fact' b oE _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1054
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      refine (_ oE (O_hfiber_O_fact fact b)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1055
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1056
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_hfiber_homotopic.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1057
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1058
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1059
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Lemma 7.6.5, part 2. *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 1062
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>Definition equiv_O_factor_hfibers_beta (a : A)
    : equiv_O_factor_hfibers (factor2 fact (factor1 fact a))
                             (factor1 fact a ; 1)
      = (factor1 fact' a ; (H a)^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1065
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1066
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold equiv_O_factor_hfibers.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1067
Time: 0.111s">
<div class="time" style="width: 22.02380952381%"></div>
<pre>
      ev_equiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1068
Time: 0.193s">
<div class="time" style="width: 38.293650793651%"></div>
<pre>
      apply moveR_equiv_M.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1069
Time: 0.017s">
<div class="time" style="width: 3.3730158730159%"></div>
<pre>
      do 2 rewrite O_hfiber_O_fact_inverse_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1070
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold equiv_fun, equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1071
Time: 0.007s">
<div class="time" style="width: 1.3888888888889%"></div>
<pre>
      transitivity (to O _
                       (equiv_hfiber_homotopic
                          (factor2 fact o factor1 fact)
                          (factor2 fact' o factor1 fact') H
                          (factor2 fact (factor1 fact a)) (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1076
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1077
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> refine (to_O_natural O _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1077
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1078
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> apply ap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1078
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1079
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
        apply ap; auto with path_hints.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1080
Time: 0.015s">
<div class="time" style="width: 2.9761904761905%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1081
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  End TwoFactorizations.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1083
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Theorem 7.6.6.  Recall that a lot of hard work was done in [Factorization.path_factorization]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 1086
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_factsys : FactorizationSystem.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1086
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1087
Time: 0.085s">
<div class="time" style="width: 16.865079365079%"></div>
<pre>
    refine (Build_FactorizationSystem
              (@IsConnMap O) _ _ _
              (@MapIn O) _ _ _
              (@image) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1091
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros A B f fact fact'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1092
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simple refine (Build_PathFactorization fact fact' _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1093
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1094
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre> refine (_ oE equiv_fibration_replacement (factor2 fact)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1094
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      refine ((equiv_fibration_replacement (factor2 fact'))^-1 oE _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1095
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (equiv_functor_sigma' 1 _); intros b; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1096
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
      apply equiv_O_factor_hfibers.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1097
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1098
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre> intros a; exact (pr1_path (equiv_O_factor_hfibers_beta f fact fact' a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1098
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1099
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1099
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      exact ((equiv_O_factor_hfibers f fact fact' (factor2 fact x) (x ; 1)).2 ^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1101
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      apply moveR_pM.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1102
Time: 0.003s">
<div class="time" style="width: 0.5952380952381%"></div>
<pre>
      refine ((inv_V _)^ @ _ @ inv_V _); apply inverse2.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1103
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      refine (_ @ pr2_path (equiv_O_factor_hfibers_beta f fact fact' a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1104
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>
      refine (_ @ (transport_paths_Fl _ _)^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1105
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (** Apparently Coq needs a little help to see that these paths are the same. *)
     </pre>
</div>
<div class="code" title="File: Modality.v
Line: 1107
Time: 0.01s">
<div class="time" style="width: 1.984126984127%"></div>
<pre>match goal with
          |- ((?p)^ @ ?q)^ = _ @ _ =&gt; change ((p^ @ q)^ = q^ @ p)
      end.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1109
Time: 0.005s">
<div class="time" style="width: 0.99206349206349%"></div>
<pre>
      refine (inv_pp _ _ @ (1 @@ inv_V _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1110
Time: 0.128s">
<div class="time" style="width: 25.396825396825%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1111
Time: 0.041s">
<div class="time" style="width: 8.1349206349206%"></div>
<pre>

End ModalFact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Modalities_Theory.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Restriction of a family of modalities *)

(** This is just like restriction of reflective subuniverses. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type Modalities_Restriction_Data (Os : Modalities).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter New_Modality : Type2@{u a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Parameter Modalities_restriction
  : New_Modality -&gt; Os.Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1124
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Modalities_Restriction_Data.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1126
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

Module Modalities_Restriction
       (Os : Modalities)
       (Res : Modalities_Restriction_Data Os)
&lt;: Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1131
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality := Res.New_Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1133
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector (O : Modality@{u a})
    := Os.O_reflector@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1136
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition In (O : Modality@{u a})
    := Os.In@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_inO (O : Modality@{u a})
    := Os.O_inO@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition to (O : Modality@{u a})
    := Os.to@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1142
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Definition inO_equiv_inO (O : Modality@{u a})
    := Os.inO_equiv_inO@{u a i j k} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1144
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition hprop_inO (H : Funext) (O : Modality@{u a})
    := Os.hprop_inO@{u a i} H (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1146
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_ind_internal (O : Modality@{u a})
    := Os.O_ind_internal@{u a i j k} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1148
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition O_ind_beta_internal (O : Modality@{u a})
    := Os.O_ind_beta_internal@{u a i j k} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition minO_paths (O : Modality@{u a})
    := Os.minO_paths@{u a i} (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1152
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

End Modalities_Restriction.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1154
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Union of families of modalities *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1157
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Modalities_FamUnion (Os1 Os2 : Modalities)
       &lt;: Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Modality : Type2@{u a}
    := Os1.Modality@{u a} + Os2.Modality@{u a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1161
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Coercion Mod_inl := inl : Os1.Modality -&gt; Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1163
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Coercion Mod_inr := inr : Os2.Modality -&gt; Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1164
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_reflector : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1167
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1168
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [O|O]; [ exact (Os1.O_reflector@{u a i} O)
                  | exact (Os2.O_reflector@{u a i} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1170
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1171
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition In : forall (O : Modality@{u a}),
                            Type2le@{i a} -&gt; Type2le@{i a}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1174
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1175
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [O|O]; [ exact (Os1.In@{u a i} O)
                  | exact (Os2.In@{u a i} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1177
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1178
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition O_inO : forall (O : Modality@{u a}) (T : Type@{i}),
                               In@{u a i} O (O_reflector@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1181
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1182
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [O|O]; [ exact (Os1.O_inO@{u a i} O)
                  | exact (Os2.O_inO@{u a i} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1184
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1185
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition to : forall (O : Modality@{u a}) (T : Type@{i}),
                   T -&gt; O_reflector@{u a i} O T.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1188
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1189
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [O|O]; [ exact (Os1.to@{u a i} O)
                  | exact (Os2.to@{u a i} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1191
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1192
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition inO_equiv_inO :
      forall (O : Modality@{u a}) (T : Type@{i}) (U : Type@{j})
             (T_inO : In@{u a i} O T) (f : T -&gt; U) (feq : IsEquiv f),
        In@{u a j} O U.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1197
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1198
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    intros [O|O]; [ exact (Os1.inO_equiv_inO@{u a i j k} O)
                  | exact (Os2.inO_equiv_inO@{u a i j k} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1200
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition hprop_inO
  : Funext -&gt; forall (O : Modality@{u a}) (T : Type@{i}),
                IsHProp (In@{u a i} O T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1205
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1206
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    intros ? [O|O]; [ exact (Os1.hprop_inO@{u a i} _ O)
                    | exact (Os2.hprop_inO@{u a i} _ O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1208
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1209
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Definition O_ind_internal
  : forall (O : Modality@{u a})
           (A : Type2le@{i a}) (B : O_reflector O A -&gt; Type2le@{j a})
           (B_inO : forall oa, In@{u a j} O (B oa)),
      (forall a, B (to O A a)) -&gt; forall a, B a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1216
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    intros [O|O]; [ exact (Os1.O_ind_internal@{u a i j k} O)
                  | exact (Os2.O_ind_internal@{u a i j k} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1218
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1219
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>

  Definition O_ind_beta_internal
  : forall (O : Modality@{u a})
           (A : Type@{i}) (B : O_reflector O A -&gt; Type@{j})
           (B_inO : forall oa, In@{u a j} O (B oa))
           (f : forall a : A, B (to O A a)) (a:A),
      O_ind_internal@{u a i j k} O A B B_inO f (to O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1226
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1227
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    intros [O|O]; [ exact (Os1.O_ind_beta_internal@{u a i j k} O)
                  | exact (Os2.O_ind_beta_internal@{u a i j k} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1229
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition minO_paths
  : forall (O : Modality@{u a})
           (A : Type2le@{i a}) (A_inO : In@{u a i} O A) (z z' : A),
      In@{u a i} O (z = z').</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1235
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1236
Time: 0.001s">
<div class="time" style="width: 0.1984126984127%"></div>
<pre>
    intros [O|O]; [ exact (Os1.minO_paths@{u a i} O)
                  | exact (Os2.minO_paths@{u a i} O) ].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1238
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1239
Time: 0.002s">
<div class="time" style="width: 0.3968253968254%"></div>
<pre>

End Modalities_FamUnion.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1242
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** For examples of modalities, see the files Notnot, Identity, Nullification, PropositionalFracture, and Localization. *)

</pre>
</div>
</body>
</html>

