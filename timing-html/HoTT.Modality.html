<html>
<head>
<title>Modality.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Modality.v</h1>

<div class="code" title="File: Modality.v
Line: 1
Time: 0.038s">
<div class="time" style="width: 63.333333333333%"></div>
<pre>Require Import Overture PathGroupoids HProp Equivalences EquivalenceVarieties.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1
Time: 0.013s">
<div class="time" style="width: 21.666666666667%"></div>
<pre>
Require Import types.Empty types.Unit types.Arrow types.Sigma types.Paths
        types.Forall types.Prod types.Universe types.ObjectClassifier.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0.003s">
<div class="time" style="width: 5%"></div>
<pre>
Require Import ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 4
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Set Implicit Arguments.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope equiv_scope.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 9
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Modalities *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 12
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 12
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {ua : Univalence}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 13
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {fs : Funext}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 14
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Quoting the HoTT Book: *)
  (** Definition 7.7.5. A _modality_ is an operation [○ : Type → Type] for which there are

    (i) functions [eta^○_A : A → ○(A)] for every type [A]

    (ii) for every [A : Type] and every type family [B : ○(A) → Type], a function

         [ind_○ : (∀ a : A, ○(B(eta^○_A(a)))) → (∀ z : ○(A), ○(B(z)))]

    (iii) A path [ind_○(f)(eta^○_A(a)) = f(a)] for each [f : ∀ a : A, ○(B(eta^○_A(a)))].

    (iv) For any [z z' : ○(A)], the function [eta^○_{z = z'} : (z = z') → ○(z = z')] is an equivalence. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 29
Time: 0.01s">
<div class="time" style="width: 16.666666666667%"></div>
<pre>Class IsModality (mod : Type -&gt; Type) :=
    { modality_eta : forall A, A -&gt; mod A;
      modality_ind : forall A (B : mod A -&gt; Type),
                       (forall a, mod (B (modality_eta a)))
                       -&gt; forall z, mod (B z);
      modality_ind_compute : forall A B (f : forall a : A, mod (B _)) a,
                               modality_ind _ f (modality_eta a) = f a;
      modality_isequiv_eta_path :&gt; forall A (z z' : mod A),
                                     IsEquiv (@modality_eta (z = z')) }.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A type is modal if its eta function is an equivalence *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 40
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>Definition ismodal (mod : Type -&gt; Type) (ismod : IsModality mod) (A:Type)
    := IsEquiv (modality_eta (A:=A)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 41
Time: 0.002s">
<div class="time" style="width: 3.3333333333333%"></div>
<pre>

  Definition hprop_ismodal (mod : Type -&gt; Type) (ismod : IsModality mod)
  : forall A, IsHProp (ismodal ismod A)
    := fun A =&gt; hprop_isequiv _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 45
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The image of a type by [mod] is always modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 48
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Lemma ismodal_mod (mod : Type -&gt; Type) (ismod : IsModality mod) (A:Type)
  : ismodal ismod (mod A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 49
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 50
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>
    apply isequiv_adjointify with (g := fun X =&gt; modality_ind (A:=mod A) (fun _ =&gt; A) idmap X).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 51
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 52
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intro x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 52
Time: 0.005s">
<div class="time" style="width: 8.3333333333333%"></div>
<pre>
      apply (equiv_inv (IsEquiv := modality_isequiv_eta_path
                                     (mod A)
                                     (modality_eta (modality_ind (fun _ : mod (mod A) =&gt; A) (fun u:mod A =&gt; u) x))
                                     x) ).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 56
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>
      generalize dependent x; apply modality_ind; intro a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 57
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply modality_eta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 58
Time: 0.004s">
<div class="time" style="width: 6.6666666666667%"></div>
<pre>
      rewrite (modality_ind_compute (fun _ : mod (mod A) =&gt; A) (fun u:mod A =&gt; u) a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 59
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact idpath.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 61
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre> exact (fun x =&gt; modality_ind_compute (fun _ : mod (mod A) =&gt; A) idmap x).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 61
Time: 0.004s">
<div class="time" style="width: 6.6666666666667%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 62
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>

  Lemma ismodal_paths (mod : Type -&gt; Type) (ismod : IsModality mod) (A:Type) (H:ismodal ismod A)
  : forall (x y:A), ismodal ismod (x=y).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 65
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 66
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x y.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 67
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>
    assert (X : (x=y) = (modality_eta x = modality_eta y)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 68
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply path_universe_uncurried.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 69
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>
    exact (BuildEquiv _ _ (ap (modality_eta (A:=A)))
                      (isequiv_ap (H:=H) x y)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    rewrite X.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 72
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>
    exact (modality_isequiv_eta_path A (modality_eta x) (modality_eta y)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 73
Time: 0.002s">
<div class="time" style="width: 3.3333333333333%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 74
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Theorem 7.7.7 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 77
Time: 0.002s">
<div class="time" style="width: 3.3333333333333%"></div>
<pre>Theorem isequiv_postcompose_eta (mod:Type -&gt; Type) (ismod : IsModality mod)
          (A:Type) (B:mod A -&gt; Type)
          (H:forall a, ismodal ismod (B a))
  : IsEquiv (fun x:(forall z:mod A, B z) =&gt; (fun y =&gt; x (modality_eta y))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 81
Time: 0.003s">
<div class="time" style="width: 5%"></div>
<pre>
    apply @isequiv_adjointify with
    (g := fun f a =&gt;
            ((equiv_inv (IsEquiv := H a)))
              (modality_ind B (fun a' =&gt; modality_eta (f a')) a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 85
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intro f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 86
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre> apply path_forall; intro x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 86
Time: 0.014s">
<div class="time" style="width: 23.333333333333%"></div>
<pre>
      rewrite (modality_ind_compute B (fun a' : A =&gt; modality_eta (f a')) x).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 87
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>
      apply eissect.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 88
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intro s.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 89
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre> apply path_forall; intro x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 89
Time: 0.003s">
<div class="time" style="width: 5%"></div>
<pre>
      assert (Y := ismodal_paths
                     (H x)
                     (s x)
                     (equiv_inv
                        (IsEquiv := H x)
                        (modality_ind B (fun y =&gt; modality_eta (s (modality_eta y))) x))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 95
Time: 0.001s">
<div class="time" style="width: 1.6666666666667%"></div>
<pre>
      refine (equiv_inv (IsEquiv := Y) _)^; clear Y.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 96
Time: 0.002s">
<div class="time" style="width: 3.3333333333333%"></div>
<pre>
      generalize dependent x; apply modality_ind; intro a; apply modality_eta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 97
Time: 0.021s">
<div class="time" style="width: 35%"></div>
<pre>
      rewrite (modality_ind_compute B (fun x =&gt; modality_eta (s (modality_eta x))) a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 98
Time: 0.003s">
<div class="time" style="width: 5%"></div>
<pre>
      rewrite eissect.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact idpath.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 100
Time: 0.017s">
<div class="time" style="width: 28.333333333333%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Corollary 7.7.8 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 104
Time: 0.01s">
<div class="time" style="width: 16.666666666667%"></div>
<pre>Definition modality_to_reflective_subuniverse (mod : Type -&gt; Type) (ismod : IsModality mod)
  : ReflectiveSubuniverse
    := Build_ReflectiveSubuniverse
         (fun T =&gt; hp (ismodal ismod T) (@hprop_ismodal mod ismod T))
         (fun T =&gt; (mod T ; ismodal_mod ismod T))
         (modality_eta)
         (fun P Q =&gt; @isequiv_postcompose_eta mod ismod P (fun _ =&gt; Q.1) (fun _ =&gt; Q.2)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Exercise 7.12 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Instance ismodality_notnot `{Funext} : IsModality (fun X =&gt; ~~X).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 114
Time: 0.06s">
<div class="time" style="width: 100%"></div>
<pre>
    apply (@Build_IsModality
             (fun X =&gt; ~~X)
             (fun X x nx =&gt; match nx x with end)
             (fun A B H' z nBz =&gt;
                z (fun a =&gt; H' a (transport (fun x =&gt; ~B x)
                                            (allpath_hprop _ _)
                                            nBz))));
    abstract (
        repeat (intro || apply path_forall);
        try match goal with
              | [ |- appcontext[match ?x : Empty with end] ] =&gt; destruct x
            end;
        refine (isequiv_adjointify
                  (fun x nx =&gt; match nx x : Empty with end)
                  (fun _ =&gt; allpath_hprop z z')
                  _
                  _);
        repeat (intro || apply path_forall);
        apply allpath_hprop
      ).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 134
Time: 0.025s">
<div class="time" style="width: 41.666666666667%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 135
Time: 0.021s">
<div class="time" style="width: 35%"></div>
<pre>

End Modalities.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

