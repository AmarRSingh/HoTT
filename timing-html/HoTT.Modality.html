<html>
<head>
<title>Modality.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Modality.v</h1>

<div class="code" title="File: Modality.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1
Time: 0.042s">
<div class="time" style="width: 5.8988764044944%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 1
Time: 0.012s">
<div class="time" style="width: 1.685393258427%"></div>
<pre>
Require Import Fibrations EquivalenceVarieties Factorization NullHomotopy.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 2
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre>
Require Export ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* [Export] because many of the lemmas and facts about reflective subuniverses are equally important for modalities. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Require Import HoTT.Tactics.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 5
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope equiv_scope.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Modalities *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 9
Time: 0.017s">
<div class="time" style="width: 2.3876404494382%"></div>
<pre>Record Modality :=
  {
    msubu : UnitSubuniverse ;
    mreplete : Replete msubu ;
    O_ind : forall A (B : msubu A -&gt; Type) (B_inO : forall oa, In msubu (B oa)),
               (forall a, B (to msubu A a)) -&gt; forall a, B a ;
    O_ind_beta : forall A B B_inO (f : forall a : A, B (to msubu A a)) a,
                    O_ind A B B_inO f (to msubu A a) = f a ;
    inO_paths : forall A (A_inO : In msubu A) (z z' : A), In msubu (z = z')
  }.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 18
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments O_ind {O} {A} B {B_inO} f a : rename.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 20
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments O_ind_beta {O} {A} B {B_inO} f a : rename.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 21
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(* We don't declare this as a coercion, since soon we're going to declare a coercion from [Modality] to [ReflectiveSubuniverse]; then we'll get this coercion automatically as a composite. *)
(* Coercion mod_usubu : Modality &gt;-&gt; UnitSubuniverse. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 24
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Existing Instance mreplete.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 24
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Global Existing Instance inO_paths.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 25
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Easy modalities *)

(** Our definition of modality is slightly different from the one in the book, which requires an induction principle only into families of the form [fun oa =&gt; O (B oa)], and similarly only that path-spaces of types [O A] are modal, where "modal" means that the unit is an equivalence.  This is equivalent, roughly since every modal type [A] (in this sense) is equivalent to [O A].

However, our definition is more convenient in formalized applications because in some examples (such as [Trunc] and closed modalities), there is a naturally occurring [O_ind] into all modal types that is not judgmentally equal to the one that can be constructed by passing through [O] and back again.  Thus, when we apply general theorems about modalities to a particular modality such as [Trunc], the proofs will reduce definitionally to "the way we would have proved them directly" if we didn't know about general modalities.

On the other hand, in other examples (such as [~~] and open modalities) it is easier to construct the latter weaker induction principle.  Thus, we now show how to get from that to our definition of modality. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 34
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section EasyModality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 34
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Context (O' : Type -&gt; Type).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 36
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Context (to_O : forall T, T -&gt; O' T).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 38
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Let inO' A := IsEquiv (to_O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 40
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Context (O_indO : forall A (B : O' A -&gt; Type),
                       (forall a, O' (B (to_O A a)))
                       -&gt; forall z, O' (B z)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 44
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

  Context (O_indO_beta : forall A B (f : forall a, O' (B (to_O A a))) a,
      O_indO A B f (to_O A a) = f a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 47
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Context (inO_pathsO : forall A (z z' : O' A), inO' (z = z')).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 49
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Here is the defined more general induction principle. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 53
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Definition O_ind' A (B : O' A -&gt; Type)
        (B_inO : forall oa, inO' (B oa))
        (f : forall a, B (to_O A a))
        (oa : O' A) : B oa.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 56
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 57
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (H := B_inO oa); unfold inO' in H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 58
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ((to_O (B oa))^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 59
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_indO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a; apply to_O, f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 62
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

  Local Definition O_ind_beta' A B {B_inO : forall oa, inO' (B oa)}
        (f : forall a : A, B (to_O A a)) a
  : O_ind' A B B_inO f (to_O A a) = f a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 66
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 67
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold O_ind'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 68
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 69
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply @O_indO_beta with (f := fun x =&gt; to_O _ (f x)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 70
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** We start by building a [UnitSubuniverse]. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 75
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Definition O_inO' A : inO' (O' A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 75
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 76
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    refine (isequiv_adjointify (to_O (O' A))
             (O_indO (O' A) (const A) idmap) _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 78
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 79
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> intros x; pattern x; apply O_ind'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 79
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros oa; apply inO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a; apply ap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (O_indO_beta (O' A) (const A) idmap a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 82
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (O_indO_beta (O' A) (const A) idmap a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 84
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 85
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** However, it seems to be surprisingly hard to show (without univalence) that this [UnitSubuniverse] is replete.  We basically have to develop enough functoriality of [O] and naturality of [to_O].  We could do that directly, but instead we piggyback by showing that it is a reflective subuniverse.  This is why we excluded repleteness from the basic definition of [ReflectiveSubuniverse] and the proofs of functoriality. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Definition O : ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 90
Time: 0.045s">
<div class="time" style="width: 6.3202247191011%"></div>
<pre>
    refine (Build_ReflectiveSubuniverse
              (Build_UnitSubuniverse
                 (fun T =&gt; IsEquiv (to_O T))
                 O' O_inO' to_O _)
              _ _ _ _);
      intros P Q ?.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 96
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_ind' P (fun _ =&gt; Q) (fun _ =&gt; Q_inO) f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_ind_beta' P (fun _ =&gt; Q) f x).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g h p x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      cbn in Q_inO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 100
Time: 0.008s">
<div class="time" style="width: 1.123595505618%"></div>
<pre>
      refine ((ap (to_O Q))^-1 _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 101
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
      refine (O_ind' P (fun y =&gt; to_O Q (g y) = to_O Q (h y)) _ _ x).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 102
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros y.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply inO_pathsO.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 104
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> intros a; apply ap, p.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 104
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 105
Time: 0.091s">
<div class="time" style="width: 12.780898876404%"></div>
<pre> intros g h p x; cbn.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 105
Time: 0.006s">
<div class="time" style="width: 0.84269662921348%"></div>
<pre>
      rewrite O_ind_beta'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 106
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
      rewrite concat_pp_p.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 107
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
      apply moveR_Vp.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 108
Time: 0.008s">
<div class="time" style="width: 1.123595505618%"></div>
<pre>
      rewrite &lt;- ap_compose.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 109
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
      exact (concat_A1p (eissect (to_O Q)) (p x)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 110
Time: 0.062s">
<div class="time" style="width: 8.7078651685393%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It is now automatically replete, since in our case [inO] means by definition that [to_O] is an equivalence. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 115
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Local Instance replete_rsubU : Replete O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 116
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    apply replete_inO_isequiv_to_O; trivial.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 117
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Finally, we can build a modality. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 122
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition Build_Modality_easy : Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 122
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 123
Time: 0.043s">
<div class="time" style="width: 6.0393258426966%"></div>
<pre>
    refine (Build_Modality O _ O_ind' O_ind_beta' _); cbn.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 124
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 125
Time: 0.023s">
<div class="time" style="width: 3.2303370786517%"></div>
<pre>

End EasyModality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modalities are reflective subuniverses *)

(** We show that modalities have underlying reflective subuniverses.  It is important in some applications, such as [Trunc], that this construction uses the general [O_ind] given as part of the modality data, and not one constructed out of [O_indO] as we did when proving [Build_Modality_easy].  For instance, this ensures that [O_functor] reduces to simply an application of [O_ind].

 Note also that our choice of how to define reflective subuniverses differently from the book enables us to prove this without using funext. *)

(** Corollary 7.7.8, part 1 *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 135
Time: 0.027s">
<div class="time" style="width: 3.7921348314607%"></div>
<pre>Definition modality_to_reflective_subuniverse (O : Modality)
: ReflectiveSubuniverse
:= Build_ReflectiveSubuniverse (msubu O)
     (fun P Q H =&gt; O_ind (fun _ =&gt; Q))
     (fun P Q H =&gt; O_ind_beta (fun _ =&gt; Q))
     (fun P Q H g h =&gt; O_ind (fun y =&gt; g y = h y))
     (fun P Q H g h =&gt; O_ind_beta (fun y =&gt; g y = h y)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 141
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Coercion modality_to_reflective_subuniverse : Modality &gt;-&gt; ReflectiveSubuniverse.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 143
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Corollary 7.7.8, part 2 *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 145
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>Global Instance inO_sigma {O : Modality} (A:Type) (B:A -&gt; Type)
       `{In O A} `{forall a, In O (B a)}
: In O {x:A &amp; B x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 147
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 148
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize dependent A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 149
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
  refine (snd (inO_sigma_iff _) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros A B ? g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 151
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>
  exists (O_ind B g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 152
Time: 0.009s">
<div class="time" style="width: 1.2640449438202%"></div>
<pre>
  apply O_ind_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 153
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 154
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Conversely, if a reflective subuniverse is closed under sigmas, it is a modality. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 157
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>Theorem reflective_subuniverse_to_modality
  (O : ReflectiveSubuniverse) {rep : Replete O}
  (H : forall (A:Type) (B:A -&gt; Type)
          `{In O A} `{forall a, In O (B a)},
     (In O ({x:A &amp; B x})))
  : Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 163
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  pose (K := fst (inO_sigma_iff _) H).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 164
Time: 0.036s">
<div class="time" style="width: 5.0561797752809%"></div>
<pre>
  exact (Build_Modality _ _
                        (fun A B B_inO g =&gt; pr1 (K A B B_inO g))
                        (fun A B B_inO g =&gt; pr2 (K A B B_inO g))
                        _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 168
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 169
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Theorem 7.3.9: The reflector [O] can be discarded inside a reflected sum. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 171
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>Definition equiv_O_sigma_O {O : Modality} {A} (P : A -&gt; Type)
: O {x:A &amp; O (P x)} &lt;~&gt; O {x:A &amp; P x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 172
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 173
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  refine (equiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 174
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 175
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre> apply O_rec; intros [a op]; revert op.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 175
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    apply O_rec; intros p.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 176
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    exact (to O _ (a;p)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 177
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 178
Time: 0.027s">
<div class="time" style="width: 3.7921348314607%"></div>
<pre> apply O_rec; intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 178
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    exact (to O _ (a ; to O _ p)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 179
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 180
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre> unfold Sect; apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 180
Time: 0.008s">
<div class="time" style="width: 1.123595505618%"></div>
<pre>
    intros [a p]; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 181
Time: 0.029s">
<div class="time" style="width: 4.0730337078652%"></div>
<pre>
    abstract (repeat (rewrite O_ind_beta; simpl); reflexivity).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 182
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 183
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre> unfold Sect; apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 183
Time: 0.019s">
<div class="time" style="width: 2.6685393258427%"></div>
<pre>
    intros [a op]; revert op; apply O_ind; try exact _; intros p; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 184
Time: 0.035s">
<div class="time" style="width: 4.9157303370787%"></div>
<pre>
    abstract (repeat (rewrite O_ind_beta; simpl); reflexivity).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 185
Time: 0.049s">
<div class="time" style="width: 6.8820224719101%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 186
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Corollary 7.3.10 *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 188
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>Corollary equiv_sigma_inO_O {O : Modality} {A} `{In O A} (P : A -&gt; Type)
: {x:A &amp; O (P x)} &lt;~&gt; O {x:A &amp; P x}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 189
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 190
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  transitivity (O {x:A &amp; O (P x)}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 191
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 192
Time: 0.009s">
<div class="time" style="width: 1.2640449438202%"></div>
<pre> apply equiv_to_O; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 192
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply equiv_O_sigma_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 193
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 194
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The induction principle [O_ind], like most induction principles, is an equivalence. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section OIndEquiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {fs : Funext} (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 197
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section OIndEquivData.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 199
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

    Context {A : Type} (B : O A -&gt; Type) `{forall a, In O (B a)}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 201
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

    Global Instance isequiv_O_ind : IsEquiv (O_ind B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 203
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 204
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
      apply isequiv_adjointify with (g := fun h =&gt; h oD to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 205
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 206
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 206
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 206
Time: 0.021s">
<div class="time" style="width: 2.9494382022472%"></div>
<pre>
        refine (O_ind (fun oa =&gt; O_ind B (h oD to O A) oa = h oa) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 207
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>
        exact (O_ind_beta B (h oD to O A)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 208
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 209
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
        exact (O_ind_beta B f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 210
Time: 0.014s">
<div class="time" style="width: 1.9662921348315%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 211
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>

    Definition equiv_O_ind
    : (forall a, B (to O A a)) &lt;~&gt; (forall oa, B oa)
    := BuildEquiv _ _ (O_ind B) _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Theorem 7.7.7 *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 218
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>Definition isequiv_oD_to_O
    : IsEquiv (fun (h : forall oa, B oa) =&gt; h oD to O A)
    := equiv_isequiv (equiv_inverse equiv_O_ind).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 220
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

  End OIndEquivData.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 222
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre>

  Local Definition isequiv_o_to_O (A B : Type) (B_inO : In O B)
  : IsEquiv (fun (h : O A -&gt; B) =&gt; h o to O A)
    := isequiv_oD_to_O (fun _ =&gt; B).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 226
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

End OIndEquiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected types *)

(** Connectedness of a type, relative to a modality, can be defined in two equivalent ways: quantifying over all maps into modal types, or by considering just the universal case, the modal reflection of the type itself.  The former requires only core Coq, but blows up the size (universe level) of [IsConnected], since it quantifies over types; moreover, it is not even quite correct since (at least with a polymorphic modality) it should really be quantified over all universes.  Thus, we use the latter, although in most examples it requires HITs to define the modal reflection.

Question: is there a definition of connectedness (say, for n-types) that neither blows up the universe level, nor requires HIT's? *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 235
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>Class IsConnected (O : Modality) (A : Type)
  := isconnected_contr_O : Contr (O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 236
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Existing Instance isconnected_contr_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 238
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedTypes.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 240
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 241
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 244
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_isconnected `{Funext} A
  : IsHProp (IsConnected O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 245
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 246
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold IsConnected; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 247
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 248
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything equivalent to a connected type is connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 251
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_equiv A {B} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnected O A -&gt; IsConnected O B.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 253
Time: 0.038s">
<div class="time" style="width: 5.3370786516854%"></div>
<pre>
    intros ?; refine (contr_equiv (O A) (O_functor O f)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 255
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

  Definition isconnected_equiv' A {B} (f : A &lt;~&gt; B)
  : IsConnected O A -&gt; IsConnected O B
    := isconnected_equiv A f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 259
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

  Definition isconnected_elim {A} `{IsConnected O A} C `{In O C} (f : A -&gt; C)
  : NullHomotopy f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 262
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    set (ff := @O_rec O _ _ _ f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 264
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    exists (ff (center _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 265
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> symmetry.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 266
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    refine (ap ff (contr (to O _ a)) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_rec_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 268
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 269
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

  Definition isconnected_from_elim {A}
  : (forall (C : Type) `{In O C} (f : A -&gt; C), NullHomotopy f)
    -&gt; IsConnected O A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 274
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 275
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    set (nh := H (O A) _ (to O A)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (nh .1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 277
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
    apply O_ind; try exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 278
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
    intros; symmetry; apply (nh .2).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 279
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 280
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A type which is both connected and truncated is contractible. *)

 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 284
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition contr_trunc_conn {A} `{In O A} `{IsConnected O A}
  : Contr A.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 286
Time: 0.014s">
<div class="time" style="width: 1.9662921348315%"></div>
<pre>
    apply (contr_equiv _ (to O A)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 287
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 288
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

End ConnectedTypes.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 290
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally truncated maps *)

(** A map is "in [O]" if each of its fibers is. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 295
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>Class MapIn (O : Modality) {A B : Type} (f : A -&gt; B)
  := inO_hfiber_ino_map : forall (b:B), In O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 296
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Existing Instance inO_hfiber_ino_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ModalMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 304
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance mapinO_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 305
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 306
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (fcontr_isequiv f _ b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 308
Time: 0.031s">
<div class="time" style="width: 4.3539325842697%"></div>
<pre>
    exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 309
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 310
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any map between modal types is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 313
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition mapinO_between_inO {A B : Type} (f : A -&gt; B)
             `{In O A} `{In O B}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 316
Time: 0.02s">
<div class="time" style="width: 2.8089887640449%"></div>
<pre>
    intros b; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 317
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a modal map is modal. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 321
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition mapinO_homotopic {A B} (f : A -&gt; B) {g : A -&gt; B}
             (p : f == g) `{MapIn O _ _ f}
  : MapIn O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 323
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 324
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 325
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre>
    refine (inO_equiv_inO (hfiber f b)
                          (equiv_hfiber_homotopic f g p b)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 327
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being modal is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 331
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_mapinO `{Funext} {A B} (f : A -&gt; B)
  : IsHProp (MapIn O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 332
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 333
Time: 0.006s">
<div class="time" style="width: 0.84269662921348%"></div>
<pre>
    apply trunc_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 334
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 335
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The composite of modal maps is modal *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 338
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Global Instance mapinO_compose {A B C} (f : A -&gt; B) (g : B -&gt; C)
         `{MapIn O _ _ f} `{MapIn O _ _ g}
  : MapIn O (g o f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 340
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 341
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 342
Time: 0.045s">
<div class="time" style="width: 6.3202247191011%"></div>
<pre>
    refine (inO_equiv_inO _ (hfiber_compose f g c)^-1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 343
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 344
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

End ModalMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 346
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected maps *)

(** Connectedness of a map can again be defined in two equivalent ways: by connectedness of its fibers (as types), or by the lifting property/elimination principle against truncated types.  We use the former; the equivalence with the latter is given below in [conn_map_elim], [conn_map_comp], and [conn_map_from_extension_elim]. *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 351
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>Class IsConnMap (O : Modality) {A B : Type} (f : A -&gt; B)
  := isconnected_hfiber_conn_map : forall b:B, IsConnected O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 352
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Existing Instance isconnected_hfiber_conn_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 354
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 356
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{Univalence} `{Funext}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 358
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is connected *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 361
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance conn_map_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 362
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 363
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 364
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (fcontr_isequiv f _ b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 365
Time: 0.013s">
<div class="time" style="width: 1.8258426966292%"></div>
<pre>
    unfold IsConnected; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 366
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 367
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a connected map is connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 370
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition conn_map_homotopic {A B : Type} (f g : A -&gt; B) (h : f == g)
  : IsConnMap O f -&gt; IsConnMap O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 371
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 372
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros ? b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 373
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre>
    exact (isconnected_equiv O (hfiber f b)
                             (equiv_hfiber_homotopic f g h b) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 375
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 376
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_isconnmap `{Funext} {A B} (f : A -&gt; B)
  : IsHProp (IsConnMap O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 380
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 381
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    apply trunc_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 382
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** n-connected maps are orthogonal to n-truncated maps (i.e. familes of n-truncated types). *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 386
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition conn_map_elim
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
             (d : forall a:A, P (f a))
  : forall b:B, P b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 390
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 391
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 392
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    refine (pr1 (isconnected_elim O _ _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 393
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    2:exact b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 394
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 395
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (transport P p (d a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 396
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 397
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

  Definition conn_map_comp
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
             (d : forall a:A, P (f a))
  : forall a:A, conn_map_elim f P d (f a) = d a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 403
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 404
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 405
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> unfold conn_map_elim.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 405
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    set (fibermap := (fun a0p : hfiber f (f a)
                      =&gt; let (a0, p) := a0p in transport P p (d a0))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 407
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>
    destruct (isconnected_elim O (P (f a)) fibermap) as [x e].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 408
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    change (d a) with (fibermap (a;1)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 409
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply inverse, e.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 410
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 411
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

  Definition isequiv_conn_ino_map {A B} (f : A -&gt; B)
             `{IsConnMap O _ _ f} `{MapIn O _ _ f}
  : IsEquiv f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 415
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 416
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_fcontr.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 417
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 417
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
    apply (contr_trunc_conn O).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 419
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** We can re-express this in terms of extensions. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 422
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Lemma extension_conn_map_elim
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
  : ExtensionAlong f P d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 427
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_comp.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 429
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 430
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

  Lemma allpath_extension_conn_map
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
        (e e' : ExtensionAlong f P d)
  : e = e'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 437
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 438
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply path_extension.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 439
Time: 0.014s">
<div class="time" style="width: 1.9662921348315%"></div>
<pre>
    refine (extension_conn_map_elim _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 440
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 441
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It follows that [conn_map_elim] is actually an equivalence. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 444
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Theorem isequiv_o_conn_map 
          {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
          (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : IsEquiv (fun (g : forall b:B, P b) =&gt; g oD f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 447
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 448
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_fcontr; intros d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 449
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply contr_inhabited_hprop.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 450
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 451
Time: 0.331s">
<div class="time" style="width: 46.488764044944%"></div>
<pre> refine (@trunc_equiv' {g : forall b, P b &amp; g oD f == d} _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 451
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 452
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> refine (equiv_functor_sigma' (equiv_idmap _) _); intros g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 452
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply equiv_path_forall.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply hprop_allpath.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 454
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g h.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 454
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
      exact (allpath_extension_conn_map f P d g h).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 455
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 456
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 456
Time: 0.006s">
<div class="time" style="width: 0.84269662921348%"></div>
<pre>
      apply path_forall; intros x; apply conn_map_comp.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 457
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 458
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Conversely, if a map satisfies this elimination principle (expressed via extensions), then it is connected.  This completes the proof of Lemma 7.5.7 from the book.

Conceptually, this proof can be seen as an instance of the fact that a left adjoint (here, pullback) preserves a left class of maps if the right adjoint (here, dependent product) preserves the right class. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 463
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Lemma conn_map_from_extension_elim {A B : Type} (f : A -&gt; B)
  : (forall (P : B -&gt; Type) {P_inO : forall b:B, In O (P b)}
            (d : forall a:A, P (f a)),
       ExtensionAlong f P d)
    -&gt; IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 467
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 468
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros Hf b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 469
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isconnected_from_elim.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 469
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros X ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 469
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    set (P := fun (b':B) =&gt; (b' = b) -&gt; X).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (forall b', In O (P b')).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 471
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 472
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 472
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> apply inO_arrow; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 472
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 472
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    set (dP := (fun (a:A) (p:f a = b) =&gt; (d (a;p)))
               : forall a:A, P (f a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 474
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    set (e := Hf P _ dP).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 475
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (e .1 b 1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 476
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 477
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> symmetry.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 477
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre> transitivity (e .1 (f a) p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 477
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    2: exact (ap10 (e.2 a) p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 478
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    refine (ap011D e.1 p^ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 479
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    refine (transport_paths_l _ _ @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 480
Time: 0.252s">
<div class="time" style="width: 35.393258426966%"></div>
<pre> hott_simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 480
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 481
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Corollary 7.5.8: It follows that the unit maps [to O A] are connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 484
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Global Instance conn_map_to_O (A : Type) : IsConnMap O (to O A).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 484
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 485
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 486
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    exists (O_ind P d); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 487
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
    apply O_ind_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 488
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 489
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.6: Connected maps compose and cancel on the right. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 492
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Global Instance conn_map_compose {A B C} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ g}
  : IsConnMap O (g o f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 494
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 495
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 496
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>
    exists (conn_map_elim g P (conn_map_elim f (P o g) d)); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 497
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    exact (conn_map_comp g P _ _ @ conn_map_comp f (P o g) d a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 498
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 499
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>      

  Definition cancelR_conn_map {A B C} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ (g o f)}
  :  IsConnMap O g.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 503
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 504
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 505
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    exists (conn_map_elim (g o f) P (d oD f)); intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 506
Time: 0.015s">
<div class="time" style="width: 2.1067415730337%"></div>
<pre>
    pattern b; refine (conn_map_elim f _ _ b); intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 507
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    exact (conn_map_comp (g o f) P (d oD f) a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 508
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 509
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (* Lemma 7.5.10: A map to a type in [O] exhibits its codomain as the [O]-reflection of its domain if (and only if) it is [O]-connected. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 512
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>Definition isequiv_O_rec_conn_map {A B : Type} `{In O B}
             (f : A -&gt; B) `{IsConnMap O _ _ f}
  : IsEquiv (O_rec f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 515
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_conn_ino_map.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 516
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 517
Time: 0.05s">
<div class="time" style="width: 7.0224719101124%"></div>
<pre> refine (cancelR_conn_map (to O A) (O_rec f)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 517
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
      refine (conn_map_homotopic f _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 518
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
      intros a; symmetry; apply O_rec_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 519
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 520
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre> apply mapinO_between_inO; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 520
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 521
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.12 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 524
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 524
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

    Context {A B} {P : A -&gt; Type} {Q : B -&gt; Type}
            (f : A -&gt; B) (g : forall a, P a -&gt; Q (f a))
            `{forall a, IsConnMap O (g a)}.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 528
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

    Definition equiv_O_hfiber_functor_sigma (b:B) (v:Q b)
    : O (hfiber (functor_sigma f g) (b;v)) &lt;~&gt; O (hfiber f b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 531
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 532
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; hfiber (g w.1) ((w.2)^ # v)}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 533
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 534
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> apply equiv_O_functor, hfiber_functor_sigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 534
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 534
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; O (hfiber (g w.1) ((w.2)^ # v))}).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 535
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Modality.v
Line: 536
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre> symmetry; apply equiv_O_sigma_O.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 536
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Modality.v
Line: 536
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 537
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>
      apply equiv_sigma_contr; intros [a p]; simpl; exact _.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 538
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 539
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

    Global Instance conn_map_functor_sigma `{IsConnMap O _ _ f}
    : IsConnMap O (functor_sigma f g).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 542
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 543
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [b v].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 544
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Why is this so slow? *)
     </pre>
</div>
<div class="code" title="File: Modality.v
Line: 546
Time: 0.362s">
<div class="time" style="width: 50.842696629213%"></div>
<pre>refine (contr_equiv _ (equiv_inverse (equiv_O_hfiber_functor_sigma b v))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 546
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 547
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>

    Definition conn_map_base_inhabited (inh : forall b, Q b)
               `{IsConnMap O _ _ (functor_sigma f g)}
    : IsConnMap O f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 552
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 553
Time: 0.024s">
<div class="time" style="width: 3.3707865168539%"></div>
<pre>
      refine (contr_equiv _ (equiv_O_hfiber_functor_sigma b (inh b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 554
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 555
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

  End ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 557
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.13.  The "if" direction is a special case of [conn_map_functor_sigma], so we prove only the "only if" direction. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 560
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition conn_map_fiber
             {A} {P Q : A -&gt; Type} (f : forall a, P a -&gt; Q a)
             `{IsConnMap O _ _ (functor_sigma idmap f)}
  : forall a, IsConnMap O (f a).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 563
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 564
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a q.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 565
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
    refine (isconnected_equiv' O (hfiber (functor_sigma idmap f) (a;q)) _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 566
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (hfiber_functor_sigma_idmap P Q f a q).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 567
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 568
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.14: Connected maps are inverted by [O]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 571
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Global Instance O_inverts_conn_map {A B} (f : A -&gt; B)
         `{IsConnMap O _ _ f}
  : IsEquiv (O_functor O f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 573
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 574
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    refine (isequiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 575
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 576
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre> apply O_rec; intros y.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 576
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre>
      exact (O_functor O pr1 (center (O (hfiber f y)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 577
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 578
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre> unfold Sect; apply O_ind; try exact _; intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 578
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
      refine (ap (O_functor O f) (O_rec_beta _ b) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 579
Time: 0.008s">
<div class="time" style="width: 1.123595505618%"></div>
<pre>
      refine ((O_functor_compose _ _ _ _)^ @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 580
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
      set (x := (center (O (hfiber f b)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 581
Time: 0.013s">
<div class="time" style="width: 1.8258426966292%"></div>
<pre>
      clearbody x; revert x; apply O_ind; try exact _; intros [a p].</pre>
</div>
<div class="code" title="File: Modality.v
Line: 582
Time: 0.006s">
<div class="time" style="width: 0.84269662921348%"></div>
<pre>
      refine (O_rec_beta (to O B o (f o pr1)) (a;p) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 583
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
      exact (ap (to O B) p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 584
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 585
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre> unfold Sect; apply O_ind; try exact _; intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 585
Time: 0.009s">
<div class="time" style="width: 1.2640449438202%"></div>
<pre>
      refine (ap (O_rec _) (to_O_natural O f a) @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 586
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
      unfold compose; refine (O_rec_beta _ _ @ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 587
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre>
      transitivity (O_functor O pr1 (to O (hfiber f (f a)) (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 588
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 589
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> apply ap, contr.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 589
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 590
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre> apply to_O_natural.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 590
Time: 0.042s">
<div class="time" style="width: 5.8988764044944%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 591
Time: 0.023s">
<div class="time" style="width: 3.2303370786517%"></div>
<pre>

End ConnectedMaps.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 593
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The modal factorization system *)

</pre>
</div>
<div class="code" title="File: Modality.v
Line: 596
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ModalFact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 596
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{fs : Funext} (O : Modality).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 597
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.6.4 *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 600
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition image {A B} (f : A -&gt; B)
  : Factorization (@IsConnMap O) (@MapIn O) f.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 601
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 602
Time: 0.061s">
<div class="time" style="width: 8.5674157303371%"></div>
<pre>
    refine (Build_Factorization {b : B &amp; O (hfiber f b)}
                                (fun a =&gt; (f a ; to O _ (a;1)))
                                pr1
                                (fun a =&gt; 1)
                                _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 607
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 608
Time: 0.107s">
<div class="time" style="width: 15.02808988764%"></div>
<pre> exact (conn_map_compose O
              (equiv_fibration_replacement f)
              (functor_sigma idmap (fun b =&gt; to O (hfiber f b)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 610
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 611
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 611
Time: 0.041s">
<div class="time" style="width: 5.7584269662921%"></div>
<pre>
      exact (inO_equiv_inO _ (hfiber_fibration b (O o (hfiber f)))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 612
Time: 0.007s">
<div class="time" style="width: 0.98314606741573%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 613
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** This is the composite of the three displayed equivalences at the beginning of the proof of Lemma 7.6.5.  Note that it involves only a single factorization of [f]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 616
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre>Lemma O_hfiber_O_fact {A B} {f : A -&gt; B}
        (fact : Factorization (@IsConnMap O) (@MapIn O) f) (b : B)
  : O (hfiber (factor2 fact o factor1 fact) b)
      &lt;~&gt; hfiber (factor2 fact) b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 619
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 620
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
    refine (equiv_compose' _
             (equiv_O_functor O
               (hfiber_compose (factor1 fact) (factor2 fact) b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 623
Time: 0.155s">
<div class="time" style="width: 21.769662921348%"></div>
<pre>
    refine (equiv_compose'
             (equiv_sigma_contr (fun w =&gt; O (hfiber (factor1 fact) w.1)))
             _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 626
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 627
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> intros w; exact (inclass1 fact w.1).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 627
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 628
Time: 0.091s">
<div class="time" style="width: 12.780898876404%"></div>
<pre> refine (equiv_inverse
                (equiv_sigma_inO_O (fun w =&gt; hfiber (factor1 fact) w.1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 629
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (inclass2 fact b).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 630
Time: 0.017s">
<div class="time" style="width: 2.3876404494382%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 631
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** This is the corresponding first three of the displayed "mapsto"s in proof of Lemma 7.6.5, and also the last three in reverse order, generalized to an arbitrary path [p].  Note that it is much harder to prove than in the book, because we are working in the extra generality of a modality where [O_ind_beta] is only propositional. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 634
Time: 0.44s">
<div class="time" style="width: 61.797752808989%"></div>
<pre>Lemma O_hfiber_O_fact_inverse_beta {A B} {f : A -&gt; B}
        (fact : Factorization (@IsConnMap O) (@MapIn O) f)
        (a : A) (b : B) (p : factor2 fact (factor1 fact a) = b)
  : (O_hfiber_O_fact fact b)^-1
      (factor1 fact a ; p) = to O _ (a ; p).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 638
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 639
Time: 0.009s">
<div class="time" style="width: 1.2640449438202%"></div>
<pre>
    set (g := factor1 fact); set (h := factor2 fact).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 640
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
    apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 641
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold O_hfiber_O_fact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 642
Time: 0.646s">
<div class="time" style="width: 90.730337078652%"></div>
<pre>
    ev_equiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 643
Time: 0.009s">
<div class="time" style="width: 1.2640449438202%"></div>
<pre>
    apply moveL_equiv_M.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 644
Time: 0.099s">
<div class="time" style="width: 13.904494382022%"></div>
<pre>
    transitivity (existT (fun (w : hfiber h b) =&gt; O (hfiber g w.1))
                         (g a; p) (to O (hfiber g (g a)) (a ; 1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 646
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 647
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre> apply moveR_equiv_V; reflexivity.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 647
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 648
Time: 0.01s">
<div class="time" style="width: 1.4044943820225%"></div>
<pre> apply moveL_equiv_V.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 648
Time: 0.078s">
<div class="time" style="width: 10.955056179775%"></div>
<pre>
      transitivity (to O _ (existT (fun (w : hfiber h b) =&gt; (hfiber g w.1))
                         (g a; p) (a ; 1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 650
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 651
Time: 0.233s">
<div class="time" style="width: 32.724719101124%"></div>
<pre> simpl; unfold compose.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 651
Time: 0.052s">
<div class="time" style="width: 7.3033707865169%"></div>
<pre>
        repeat (rewrite O_ind_beta; simpl); reflexivity.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 652
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Modality.v
Line: 653
Time: 0.389s">
<div class="time" style="width: 54.634831460674%"></div>
<pre> simpl rewrite O_ind_beta; reflexivity.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 653
Time: 0.417s">
<div class="time" style="width: 58.567415730337%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 654
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section TwoFactorizations.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 656
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
    Context {A B : Type} (f : A -&gt; B)
            (fact fact' : Factorization (@IsConnMap O) (@MapIn O) f).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 658
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>

    Let H := fun x =&gt; fact_factors fact x @ (fact_factors fact' x)^.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 660
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Lemma 7.6.5, part 1. *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 663
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>Definition equiv_O_factor_hfibers (b:B)
    : hfiber (factor2 fact) b &lt;~&gt; hfiber (factor2 fact') b.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 664
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 665
Time: 0.012s">
<div class="time" style="width: 1.685393258427%"></div>
<pre>
      refine (equiv_compose' (O_hfiber_O_fact fact' b) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 666
Time: 0.017s">
<div class="time" style="width: 2.3876404494382%"></div>
<pre>
      refine (equiv_compose' _ (equiv_inverse (O_hfiber_O_fact fact b))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 667
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 668
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_hfiber_homotopic.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 669
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
      exact H.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 670
Time: 0.031s">
<div class="time" style="width: 4.3539325842697%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 671
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Lemma 7.6.5, part 2. *)
   </pre>
</div>
<div class="code" title="File: Modality.v
Line: 674
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>Definition equiv_O_factor_hfibers_beta (a : A)
    : equiv_O_factor_hfibers (factor2 fact (factor1 fact a))
                             (factor1 fact a ; 1)
      = (factor1 fact' a ; (H a)^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 677
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 678
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold equiv_O_factor_hfibers.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 679
Time: 0.522s">
<div class="time" style="width: 73.314606741573%"></div>
<pre>
      ev_equiv.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 680
Time: 0.583s">
<div class="time" style="width: 81.88202247191%"></div>
<pre>
      apply moveR_equiv_M.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 681
Time: 0.07s">
<div class="time" style="width: 9.8314606741573%"></div>
<pre>
      do 2 rewrite O_hfiber_O_fact_inverse_beta.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 682
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold equiv_fun, equiv_O_functor.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 683
Time: 0.045s">
<div class="time" style="width: 6.3202247191011%"></div>
<pre>
      transitivity (to O _
                       (equiv_hfiber_homotopic
                          (factor2 fact o factor1 fact)
                          (factor2 fact' o factor1 fact') H
                          (factor2 fact (factor1 fact a)) (a;1))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 688
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 689
Time: 0.013s">
<div class="time" style="width: 1.8258426966292%"></div>
<pre> refine (to_O_natural O _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 689
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 690
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre> apply ap.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 690
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre>
        simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 691
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
        apply ap; auto with path_hints.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 692
Time: 0.103s">
<div class="time" style="width: 14.466292134831%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 693
Time: 0.009s">
<div class="time" style="width: 1.2640449438202%"></div>
<pre>

  End TwoFactorizations.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 695
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Theorem 7.6.6.  Recall that a lot of hard work was done in [Factorization.path_factorization]. *)
 </pre>
</div>
<div class="code" title="File: Modality.v
Line: 698
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_factsys : FactorizationSystem.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 698
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 699
Time: 0.028s">
<div class="time" style="width: 3.9325842696629%"></div>
<pre>
    refine (Build_FactorizationSystem
              (@IsConnMap O) _ _ _
              (@MapIn O) _ _ _
              (@image) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 703
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros A B f fact fact'.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 704
Time: 0.02s">
<div class="time" style="width: 2.8089887640449%"></div>
<pre>
    refine (Build_PathFactorization fact fact' _ _ _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 705
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 706
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre> refine (equiv_compose' _ (equiv_fibration_replacement (factor2 fact))).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 706
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
      refine (equiv_compose' (equiv_inverse (equiv_fibration_replacement (factor2 fact'))) _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 707
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
      refine (equiv_functor_sigma' (equiv_idmap B) _); intros b; simpl.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 708
Time: 0.001s">
<div class="time" style="width: 0.14044943820225%"></div>
<pre>
      apply equiv_O_factor_hfibers.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 709
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 710
Time: 0.004s">
<div class="time" style="width: 0.56179775280899%"></div>
<pre> intros a; exact (pr1_path (equiv_O_factor_hfibers_beta f fact fact' a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 710
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 711
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 711
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
      exact ((equiv_O_factor_hfibers f fact fact' (factor2 fact x) (x ; 1)).2 ^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 712
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 713
Time: 0.002s">
<div class="time" style="width: 0.28089887640449%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 713
Time: 0.005s">
<div class="time" style="width: 0.70224719101124%"></div>
<pre>
      apply moveR_pM.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 714
Time: 0.146s">
<div class="time" style="width: 20.505617977528%"></div>
<pre>
      refine ((inv_V _)^ @ _ @ inv_V _); apply inverse2.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 715
Time: 0.061s">
<div class="time" style="width: 8.5674157303371%"></div>
<pre>
      refine (_ @ pr2_path (equiv_O_factor_hfibers_beta f fact fact' a)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 716
Time: 0.102s">
<div class="time" style="width: 14.325842696629%"></div>
<pre>
      refine (_ @ (transport_paths_Fl _ _)^).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 717
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (** Apparently Coq needs a little help to see that these paths are the same. *)
     </pre>
</div>
<div class="code" title="File: Modality.v
Line: 719
Time: 0.044s">
<div class="time" style="width: 6.1797752808989%"></div>
<pre>match goal with
          |- ((?p)^ @ ?q)^ = _ @ _ =&gt; change ((p^ @ q)^ = q^ @ p)
      end.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 721
Time: 0.161s">
<div class="time" style="width: 22.612359550562%"></div>
<pre>
      refine (inv_pp _ _ @ (1 @@ inv_V _)).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 722
Time: 0.712s">
<div class="time" style="width: 100%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 723
Time: 0.204s">
<div class="time" style="width: 28.651685393258%"></div>
<pre>

End ModalFact.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 725
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Examples *)

(** Finally, we give one nontrivial example of a modality.  This is Exercise 7.12 in the book. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 729
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition notnot_modality `{Funext} : Modality.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 729
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 730
Time: 0.014s">
<div class="time" style="width: 1.9662921348315%"></div>
<pre>
  refine (Build_Modality_easy
            (fun X =&gt; ~~X)
            (fun X x nx =&gt; nx x)
            (fun A B f z nBz =&gt;
              z (fun a =&gt; f a (transport (fun x =&gt; ~B x)
                                          (path_ishprop _ _)
                                          nBz)))
            _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 738
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 739
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre> intros; apply path_ishprop.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 739
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Modality.v
Line: 740
Time: 0.076s">
<div class="time" style="width: 10.674157303371%"></div>
<pre> intros; refine (isequiv_iff_hprop _ _).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 740
Time: 0.01s">
<div class="time" style="width: 1.4044943820225%"></div>
<pre>
    intros; apply path_ishprop.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 741
Time: 0.003s">
<div class="time" style="width: 0.42134831460674%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Modality.v
Line: 742
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Of course, there is also the trivial example. *)</pre>
</div>
<div class="code" title="File: Modality.v
Line: 744
Time: 0.011s">
<div class="time" style="width: 1.5449438202247%"></div>
<pre>Definition identity_modality : Modality
  := Build_Modality
     (Build_UnitSubuniverse
        (fun _ =&gt; Unit)
        idmap
        (fun _ =&gt; tt)
        (fun T =&gt; idmap)
        _)
     (fun T U _ _ _ =&gt; tt)
     (fun A B _ f a =&gt; f a)
     (fun A B _ f a =&gt; 1)
     (fun A _ z z' =&gt; tt).</pre>
</div>
<div class="code" title="File: Modality.v
Line: 756
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** For more examples of modalities, see hit/Truncations.v and hit/PropositionalFracture.v. *)

</pre>
</div>
</body>
</html>

