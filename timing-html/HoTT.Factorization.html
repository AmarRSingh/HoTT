<html>
<head>
<title>Factorization.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Factorization.v</h1>

<div class="code" title="File: Factorization.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)

(** * Factorizations and factorization systems. *)

</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 4
Time: 0.015s">
<div class="time" style="width: 1.227495908347%"></div>
<pre>Require Import HoTT.Basics.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 4
Time: 0.014s">
<div class="time" style="width: 1.1456628477905%"></div>
<pre>
Require Import types.Record types.Sigma types.Universe types.Arrow types.Forall types.Paths.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 5
Time: 0.015s">
<div class="time" style="width: 1.227495908347%"></div>
<pre>
Require Import ReflectiveSubuniverse Modality HProp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 6
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>
Require Import HoTT.Tactics.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope equiv_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 9
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Factorizations *)

</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 12
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section Factorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 12
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It's important that these are all declared with a single [Context] command, so that the marker [@{i}] refers to the same universe level in all of them. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 15
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>Context {class1 class2 : forall (X Y : Type@{i}), (X -&gt; Y) -&gt; Type@{i}}
          `{forall (X Y : Type@{i}) (g:X-&gt;Y), IsHProp (class1 _ _ g)}
          `{forall (X Y : Type@{i}) (g:X-&gt;Y), IsHProp (class2 _ _ g)}
          {A B : Type@{i}} {f : A -&gt; B}.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 18
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A factorization of [f] into a first factor lying in [class1] and a second factor lying in [class2]. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 21
Time: 0.004s">
<div class="time" style="width: 0.32733224222586%"></div>
<pre>Record Factorization :=
    { intermediate : Type ;
      factor1 : A -&gt; intermediate ;
      factor2 : intermediate -&gt; B ;
      fact_factors : factor2 o factor1 == f ;
      inclass1 : class1 _ _ factor1 ;
      inclass2 : class2 _ _ factor2
    }.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 28
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>

  Lemma issig_Factorization :
    { I : Type &amp; { g : A -&gt; I &amp; { h : I -&gt; B &amp; { p : h o g == f &amp;
      { gin1 : class1 _ _ g &amp; class2 _ _ h }}}}}
      &lt;~&gt; Factorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 33
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 34
Time: 0.017s">
<div class="time" style="width: 1.3911620294599%"></div>
<pre>
    issig Build_Factorization intermediate factor1 factor2 fact_factors inclass1 inclass2.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 35
Time: 0.06s">
<div class="time" style="width: 4.9099836333879%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 36
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (* This enables [simpl rewrite] to unfold [compose]. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 39
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Arguments compose / .</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 39
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A path between factorizations is equivalent to a structure of the following sort. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 42
Time: 0.022s">
<div class="time" style="width: 1.8003273322422%"></div>
<pre>Record PathFactorization {fact fact' : Factorization} :=
    { path_intermediate : intermediate fact &lt;~&gt; intermediate fact' ;
      path_factor1 : path_intermediate o factor1 fact == factor1 fact' ;
      path_factor2 : factor2 fact == factor2 fact' o path_intermediate ;
      path_fact_factors : forall a, path_factor2 (factor1 fact a)
                          @ ap (factor2 fact') (path_factor1 a)
                          @ fact_factors fact' a
                          = fact_factors fact a
    }.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 50
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It's easy to extract such a structure from an actual path between factorizations. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 53
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition pathfactorization_path (fact fact' : Factorization)
    : (fact = fact') -&gt; @PathFactorization fact fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 54
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 55
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 56
Time: 0.014s">
<div class="time" style="width: 1.1456628477905%"></div>
<pre>
    refine (Build_PathFactorization fact fact' _ _ _ _); destruct p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 57
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 58
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (equiv_idmap (intermediate fact)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 58
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 59
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fun a =&gt; 1).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 59
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fun x =&gt; 1).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (fun a =&gt; concat_1p _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 61
Time: 0.009s">
<div class="time" style="width: 0.73649754500818%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 62
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The converse, however, is more work. In the proof of Theorem 7.6.6, the book glosses over this theorem with the phrase "by univalence and the characterization of paths and transport in Sigma-types, function types, and path types".  Which is arguably fair informally, because it's "obvious", but it turns out to be a good deal of work to keep track of all the transport lemmas and apply naturality in the right places. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 65
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section PathFactorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 65
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Context `{Univalence} {fact fact' : Factorization}
            (pf : @PathFactorization fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 67
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Let's give short names to the fields of [pf]. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 70
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Let II := path_intermediate pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 70
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Let ff1 := path_factor1 pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Let ff2 := path_factor2 pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 72
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Let fff := path_fact_factors pf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 73
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Each of those fields now induces a corresponding (dependent) path.  The first one is easy. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 76
Time: 0.005s">
<div class="time" style="width: 0.40916530278232%"></div>
<pre>Local Definition II' : intermediate fact = intermediate fact'
      := path_universe II.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 77
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The second is slightly harder, but at least its type is obvious. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Definition ff1'
      : transport (fun X =&gt; A -&gt; X) II' (factor1 fact) = factor1 fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 82
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_arrow; intros a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 83
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>
      refine (transport_arrow_fromconst (C := idmap) _ _ a @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 84
Time: 0.003s">
<div class="time" style="width: 0.24549918166939%"></div>
<pre>
      etransitivity; [ apply transport_path_universe | ].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 85
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>
      apply ff1.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 86
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 87
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The type of the third is just like the type of the second, but its proof is a bit more complicated because the type of [ff2] isn't exactly the way it appears naturally here. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Definition ff2'
      : transport (fun X =&gt; X -&gt; B) II' (factor2 fact) = factor2 fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 92
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>
      apply path_arrow; intros a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 93
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>
      refine (transport_arrow_toconst (B := idmap) _ _ a @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 94
Time: 0.004s">
<div class="time" style="width: 0.32733224222586%"></div>
<pre>
      etransitivity; [ apply ap, transport_path_universe_V | ].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 95
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>
      etransitivity; [ apply ff2 | ].</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 96
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold compose; apply ap.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 97
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>
      apply eisretr.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 98
Time: 0.005s">
<div class="time" style="width: 0.40916530278232%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Finally, even the type of this one is rather intimidating.  It's hard to justify this type until you get to the end of the proof of [path_factorization], below, and see that it's exactly what we need to complete it.  We prove it separately first so that we can make it opaque for performance reasons (roughly a 2x speedup).  Note that we can't make [II'], [ff1'], or [ff2'] opaque, since they have to be unfolded in this proof and the next. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 102
Time: 0.015s">
<div class="time" style="width: 1.227495908347%"></div>
<pre>Local Definition fff' (a : A)
    : (transportD2 (fun X =&gt; A -&gt; X) (fun X =&gt; X -&gt; B)
                   (fun X g h =&gt; {_ : forall a : A, h (g a) = f a &amp;
                                  {_ : class1 A X g &amp; class2 X B h}})
                   II' (factor1 fact) (factor2 fact)
                   (fact_factors fact; (inclass1 fact; inclass2 fact))).1 a =
      ap (transport (fun X =&gt; X -&gt; B) II' (factor2 fact))
        (transport_arrow_fromconst II' (factor1 fact) a
          @ transport_path_universe II (factor1 fact a)
          @ ff1 a)
        @ transport_arrow_toconst II' (factor2 fact) (factor1 fact' a)
        @ ap (factor2 fact) (transport_path_universe_V II (factor1 fact' a))
        @ ff2 (II^-1 (factor1 fact' a))
        @ ap (factor2 fact') (eisretr II (factor1 fact' a))
        @ fact_factors fact' a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 117
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* The name of the game is looking for naturality properties so that we can apply [fff], so [long_path_scope] is helpful to be able to see the shape of the goal better. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Open Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Here is a fairly obvious beginning. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 121
Time: 0.021s">
<div class="time" style="width: 1.7184942716858%"></div>
<pre>rewrite (ap_transport_arrow_toconst (B := idmap) (C := B)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we set up for a naturality *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 123
Time: 0.065s">
<div class="time" style="width: 5.3191489361702%"></div>
<pre>simpl rewrite (@ap_compose _ _ _ (transport idmap (path_universe II)^)
                                 (factor2 fact)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 124
Time: 0.195s">
<div class="time" style="width: 15.957446808511%"></div>
<pre>
      rewrite &lt;- ap_p_pp; rewrite_moveL_Mp_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 125
Time: 0.022s">
<div class="time" style="width: 1.8003273322422%"></div>
<pre>
      Fail rewrite (concat_Ap ff2).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* Maybe one day rewrite will be smarter *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 127
Time: 0.034s">
<div class="time" style="width: 2.7823240589198%"></div>
<pre>refine (_ @ (((concat_Ap ff2 _)^ @@ 1) @@ 1)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Next is another naturality  *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 129
Time: 0.018s">
<div class="time" style="width: 1.4729950900164%"></div>
<pre>rewrite ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 129
Time: 0.012s">
<div class="time" style="width: 0.98199672667758%"></div>
<pre>
      Fail rewrite &lt;- ap_p_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 130
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>    (* Yeah, rewrite. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 131
Time: 0.027s">
<div class="time" style="width: 2.2094926350246%"></div>
<pre>refine (_ @ (ap_p_pp (factor2 fact') _ _ _ @@ 1)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 131
Time: 0.147s">
<div class="time" style="width: 12.0294599018%"></div>
<pre>
      repeat rewrite (ap_pp (transport idmap (path_universe II)^)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 132
Time: 0.021s">
<div class="time" style="width: 1.7184942716858%"></div>
<pre>
      rewrite concat_pA_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 133
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* And another one *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 135
Time: 0.177s">
<div class="time" style="width: 14.484451718494%"></div>
<pre>repeat rewrite (ap_pp II).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 135
Time: 0.077s">
<div class="time" style="width: 6.3011456628478%"></div>
<pre>
      rewrite &lt;- (ap_compose (II^-1) II); unfold compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 136
Time: 0.034s">
<div class="time" style="width: 2.7823240589198%"></div>
<pre>
      rewrite (concat_pA1_p (eisretr II) (ff1 a)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 137
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we use the triangle identity of our equivalence [II]. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 139
Time: 0.03s">
<div class="time" style="width: 2.4549918166939%"></div>
<pre>rewrite (ap_pp (factor2 fact')).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 139
Time: 0.039s">
<div class="time" style="width: 3.1914893617021%"></div>
<pre>
      unfold compose; rewrite eisadj.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* And one more naturality *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 142
Time: 0.063s">
<div class="time" style="width: 5.1554828150573%"></div>
<pre>repeat rewrite concat_p_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 142
Time: 0.098s">
<div class="time" style="width: 8.0196399345336%"></div>
<pre>
      repeat rewrite &lt;- ap_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 143
Time: 0.019s">
<div class="time" style="width: 1.5548281505728%"></div>
<pre>
      rewrite &lt;- ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 144
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Here we [refine] rather than [rewrite] to specify exactly *where* we want to apply naturality. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 146
Time: 0.036s">
<div class="time" style="width: 2.9459901800327%"></div>
<pre>refine (_ @ (((concat_Ap ff2 _) @@ 1) @@ 1)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 146
Time: 0.152s">
<div class="time" style="width: 12.438625204583%"></div>
<pre>
      rewrite_moveL_Mp_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 147
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Finally we can use [fff]! *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 149
Time: 0.01s">
<div class="time" style="width: 0.81833060556465%"></div>
<pre>refine (_ @ (fff a)^).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 149
Time: 0.168s">
<div class="time" style="width: 13.747954173486%"></div>
<pre>
      do 2 rewrite_moveR_Vp_p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we still have a mess, but with a little futzing we can put it into a form that we can do path induction over.  The point is to make it all a function of [path_universe II].  In particular, we need to eliminate [eissect II], which we do with [transport_path_universe_Vp]. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 152
Time: 0.033s">
<div class="time" style="width: 2.7004909983633%"></div>
<pre>rewrite (ap_pp (transport idmap (path_universe II)^)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 152
Time: 0.152s">
<div class="time" style="width: 12.438625204583%"></div>
<pre>
      with_rassoc ltac:(rewrite (ap_pp (factor2 fact))).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 153
Time: 0.035s">
<div class="time" style="width: 2.8641571194763%"></div>
<pre>
      unfold II'; rewrite transport_path_universe_Vp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 154
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* This mess is completely general in [path_universe II]! *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 156
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>fold II.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 156
Time: 0.056s">
<div class="time" style="width: 4.582651391162%"></div>
<pre> set (p := path_universe II); clearbody p.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 156
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>
      case p; cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 157
Time: 0.007s">
<div class="time" style="width: 0.57283142389525%"></div>
<pre> auto with path_hints.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 157
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 158
Time: 1.024s">
<div class="time" style="width: 83.79705400982%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 159
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Finally, we're ready to prove the main theorem. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition path_factorization : fact = fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 163
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* The idea is of course to decompose [Factorization] as a sigma and use [path_sigma] over and over again.  It's fairly easy to insert [II], [ff1], and [ff2] in the right places. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 165
Time: 0.017s">
<div class="time" style="width: 1.3911620294599%"></div>
<pre>apply ((ap issig_Factorization^-1)^-1); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 165
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>
      refine (path_sigma' _ II' _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 166
Time: 0.018s">
<div class="time" style="width: 1.4729950900164%"></div>
<pre>
      refine (transport_sigma_' _ _ @ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 167
Time: 0.008s">
<div class="time" style="width: 0.65466448445172%"></div>
<pre>
      refine (path_sigma' _ ff1' _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 168
Time: 0.017s">
<div class="time" style="width: 1.3911620294599%"></div>
<pre>
      refine (transport_sigma' _ _ @ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 169
Time: 0.007s">
<div class="time" style="width: 0.57283142389525%"></div>
<pre>
      refine (path_sigma' _ ff2' _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 170
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Now we have a gigantic mess, but fortunately it simplifies a great deal because the last two components are hprops. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 172
Time: 0.023s">
<div class="time" style="width: 1.8821603927987%"></div>
<pre>refine (transport_sigma (A := intermediate fact' -&gt; B)
                              (B := fun g =&gt; g o factor1 fact' == f)
                              _ _ @ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 174
Time: 0.016s">
<div class="time" style="width: 1.3093289689034%"></div>
<pre>
      refine (path_sigma' _ _ _); cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 175
Time: 0.01s">
<div class="time" style="width: 0.81833060556465%"></div>
<pre>
      2:apply path_ishprop.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 176
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* It's still pretty scary-looking, but we press ahead undaunted, looking for transport redexes and path redexes. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 178
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>apply path_forall; intros a.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 178
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold pointwise_paths.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 179
Time: 0.01s">
<div class="time" style="width: 0.81833060556465%"></div>
<pre>
      rewrite transport_forall_constant, transport_paths_Fl.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 180
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold II', ff1', ff2'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 181
Time: 0.028s">
<div class="time" style="width: 2.291325695581%"></div>
<pre>
      rewrite ap_apply_l, ap10_path_arrow.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 182
Time: 0.053s">
<div class="time" style="width: 4.3371522094926%"></div>
<pre>
      rewrite transport_sigma_'; cbn.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 183
Time: 0.04s">
<div class="time" style="width: 3.2733224222586%"></div>
<pre>
      rewrite transport_forall_constant, transport_paths_Fl.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 184
Time: 0.045s">
<div class="time" style="width: 3.6824877250409%"></div>
<pre>
      simpl rewrite (@ap_compose _ _ _
                                 (fun g:A-&gt;intermediate fact' =&gt; g a)
                                 (fun x =&gt; transport (fun X =&gt; X -&gt; B) (path_universe II)
                                                     (factor2 fact) x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 188
Time: 0.056s">
<div class="time" style="width: 4.582651391162%"></div>
<pre>
      rewrite ap_apply_l, ap10_path_arrow.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 189
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Finally we can apply our monster lemma [fff']. *)
     </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 191
Time: 0.107s">
<div class="time" style="width: 8.7561374795417%"></div>
<pre>do 2 apply moveR_Vp; repeat rewrite concat_p_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 191
Time: 0.019s">
<div class="time" style="width: 1.5548281505728%"></div>
<pre>
      exact (fff' a).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 192
Time: 1.222s">
<div class="time" style="width: 100%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 193
Time: 0.499s">
<div class="time" style="width: 40.834697217676%"></div>
<pre>

  End PathFactorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 195
Time: 1.025s">
<div class="time" style="width: 83.878887070376%"></div>
<pre>
End Factorization.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments Factorization class1 class2 {A B} f.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 198
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments PathFactorization {class1 class2 A B f} fact fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 199
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Factorization Systems *)

(** A ("unique" or "orthogonal") factorization system consists of a couple of classes of maps, closed under composition, such that every map admits a unique factorization. *)</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 203
Time: 0.015s">
<div class="time" style="width: 1.227495908347%"></div>
<pre>Record FactorizationSystem :=
  { class1 : forall {X Y : Type@{i}}, (X -&gt; Y) -&gt; Type ;
    ishprop_class1 : forall {X Y : Type@{i}} (g:X-&gt;Y), IsHProp (class1 g) ;
    class1_isequiv : forall {X Y : Type@{i}} (g:X-&gt;Y) {geq:IsEquiv g}, class1 g ;
    class1_compose : forall {X Y Z : Type@{i}} (g:X-&gt;Y) (h:Y-&gt;Z),
                       class1 g -&gt; class1 h -&gt; class1 (h o g) ;
    class2 : forall {X Y : Type@{i}}, (X -&gt; Y) -&gt; Type ;
    ishprop_class2 : forall {X Y : Type@{i}} (g:X-&gt;Y), IsHProp (class2 g) ;
    class2_isequiv : forall {X Y : Type@{i}} (g:X-&gt;Y) {geq:IsEquiv g}, class2 g ;
    class2_compose : forall {X Y Z : Type@{i}} (g:X-&gt;Y) (h:Y-&gt;Z),
                       class2 g -&gt; class2 h -&gt; class2 (h o g) ;
    (** Morally, the uniqueness of factorizations says that [Factorization class1 class2 f] is contractible.  However, in practice we always *prove* that by way of [path_factorization], and we frequently want to *use* the components of a [PathFactorization] as well.  Thus, as data we store the canonical factorization and a [PathFactorization] between any two such, and prove in a moment that this implies contractibility of the space of factorizations. *)
    factor : forall {X Y : Type@{i}} (f:X-&gt;Y), Factorization@{i i} (@class1) (@class2) f ;
    path_factor : forall {X Y : Type@{i}} (f:X-&gt;Y)
                         (fact : Factorization@{i i} (@class1) (@class2) f)
                         (fact' : Factorization@{i i} (@class1) (@class2) f),
                    PathFactorization@{i i i} fact fact'
  }.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 220
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Existing Instances ishprop_class1 ishprop_class2.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 222
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section FactSys.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 224
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Context `{Univalence} (factsys : FactorizationSystem).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 226
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition Build_Factorization' {X Y}
    := @Build_Factorization (@class1 factsys) (@class2 factsys) X Y.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 229
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>

  Definition Build_PathFactorization' {X Y}
    := @Build_PathFactorization (@class1 factsys) (@class2 factsys) X Y.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 232
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The type of factorizations is, as promised, contractible. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 235
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Theorem contr_factor {X Y} (f : X -&gt; Y)
  : Contr (Factorization (@class1 factsys) (@class2 factsys) f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 236
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 237
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply contr_inhabited_hprop.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 238
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply hprop_allpath.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros fact fact'.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 240
Time: 0.008s">
<div class="time" style="width: 0.65466448445172%"></div>
<pre>
      apply path_factorization; try exact _.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 241
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_factor.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 242
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 243
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply factor.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 243
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 244
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The two classes of maps are automatically orthogonal, i.e. any commutative square from a [class1] map to a [class2] map has a unique diagonal filler.  For now, we only bother to define the lift; in principle we ought to show that the type of lifts is contractible. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 247
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>Context {A B X Y : Type@{i}}
          (i : A -&gt; B) (c1i : class1 factsys i)
          (p : X -&gt; Y) (c2p : class2 factsys p)
          (f : A -&gt; X) (g : B -&gt; Y) (h : p o f == g o i).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 250
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** First we factor [f] *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Let C  : Type         := intermediate (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let f1 : A -&gt; C       := factor1      (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let f2 : C -&gt; X       := factor2      (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 255
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let ff : f2 o f1 == f := fact_factors (factor factsys f).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 256
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** and [g] *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Let D  : Type         := intermediate (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let g1 : B -&gt; D       := factor1      (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 260
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let g2 : D -&gt; Y       := factor2      (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 261
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>
  Let gf : g2 o g1 == g := fact_factors (factor factsys g).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 262
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Now we observe that [p o f2] and [f1], and [g2] and [g1 o i], are both factorizations of the common diagonal of the commutative square (for which we use [p o f], but we could equally well use [g o i]. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 265
Time: 0.004s">
<div class="time" style="width: 0.32733224222586%"></div>
<pre>Let fact  : Factorization (@class1 factsys) (@class2 factsys) (p o f) 
            := Build_Factorization' (p o f) C f1 (p o f2)
                 (fun a =&gt; ap p (ff a))
                 (inclass1 (factor factsys f))
                 (class2_compose factsys f2 p
                                 (inclass2 (factor factsys f))
                                 c2p).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 271
Time: 0.004s">
<div class="time" style="width: 0.32733224222586%"></div>
<pre>
  Let fact' : Factorization (@class1 factsys) (@class2 factsys) (p o f)
            := Build_Factorization' (p o f) D (g1 o i) g2
                 (fun a =&gt; gf (i a) @ (h a)^)
                 (class1_compose factsys i g1 c1i
                                 (inclass1 (factor factsys g)))
                 (inclass2 (factor factsys g)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Therefore, by the uniqueness of factorizations, we have an equivalence [q] relating them. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 280
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>Let q  : C &lt;~&gt; D          := path_intermediate
                                 (path_factor factsys (p o f) fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 281
Time: 0.005s">
<div class="time" style="width: 0.40916530278232%"></div>
<pre>
  Let q1 : q o f1 == g1 o i := path_factor1
                                 (path_factor factsys (p o f) fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 283
Time: 0.005s">
<div class="time" style="width: 0.40916530278232%"></div>
<pre>
  Let q2 : p o f2 == g2 o q := path_factor2
                                 (path_factor factsys (p o f) fact fact').</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Using this, we can define the lift. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 288
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>Definition lift_factsys : B -&gt; X
    := f2 o q^-1 o g1.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 289
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** And the commutative triangles making it a lift *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 292
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition lift_factsys_tri1 : lift_factsys o i == f.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 292
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 293
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 294
Time: 0.003s">
<div class="time" style="width: 0.24549918166939%"></div>
<pre>
    refine (ap (f2 o q^-1) (q1 x)^ @ _); unfold compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 295
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>
    transitivity (f2 (f1 x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 296
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 297
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre> apply ap, eissect.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 297
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 298
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre> apply ff.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 298
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition lift_factsys_tri2 : p o lift_factsys == g.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 303
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>
    refine (q2 _ @ _); unfold compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 304
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>
    transitivity (g2 (g1 x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 305
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 306
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre> apply ap, eisretr.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 306
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 307
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre> apply gf.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 307
Time: 0.002s">
<div class="time" style="width: 0.16366612111293%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** And finally prove that these two triangles compose to the given commutative square. *)
 </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 311
Time: 0.001s">
<div class="time" style="width: 0.081833060556465%"></div>
<pre>Definition lift_factsys_square (x : A)
  : ap p (lift_factsys_tri1 x)^ @ lift_factsys_tri2 (i x) = h x.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 312
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 313
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold lift_factsys_tri1, lift_factsys_tri2.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 314
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Open Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* First we use the one aspect of the uniqueness of factorizations that we haven't mentioned yet. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 317
Time: 0.013s">
<div class="time" style="width: 1.063829787234%"></div>
<pre>pose (r := path_fact_factors (path_factor factsys (p o f) fact fact') x
            : q2 (f1 x) @ ap g2 (q1 x) @ (gf (i x) @ (h x)^) = ap p (ff x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 318
Time: 0.004s">
<div class="time" style="width: 0.32733224222586%"></div>
<pre>
    rewrite concat_p_pp in r.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 319
Time: 0.003s">
<div class="time" style="width: 0.24549918166939%"></div>
<pre>
    apply moveL_pM, moveR_Vp in r.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 320
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>
    refine (_ @ r); clear r.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 321
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Now we can cancel some whiskered paths on both sides. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 323
Time: 0.073s">
<div class="time" style="width: 5.9738134206219%"></div>
<pre>repeat rewrite inv_pp; repeat rewrite ap_pp; rewrite ap_V.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 323
Time: 0.08s">
<div class="time" style="width: 6.5466448445172%"></div>
<pre>
    repeat rewrite concat_pp_p; apply whiskerL.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 324
Time: 0.061s">
<div class="time" style="width: 4.9918166939444%"></div>
<pre>
    repeat rewrite concat_p_pp; apply whiskerR.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 325
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Next we set up for a naturality. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 327
Time: 0.031s">
<div class="time" style="width: 2.5368248772504%"></div>
<pre>rewrite ap_compose, &lt;- ap_pp, &lt;- inv_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 327
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>
    Fail rewrite &lt;- ap_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>    (* rewrite, I hardly knew ye *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 329
Time: 0.028s">
<div class="time" style="width: 2.291325695581%"></div>
<pre>refine (((ap (ap p) (inverse2 (ap_pp f2 _ _)^) @@ 1) @@ 1) @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 329
Time: 0.015s">
<div class="time" style="width: 1.227495908347%"></div>
<pre>
    rewrite &lt;- ap_V, &lt;- ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 330
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>
    Fail rewrite concat_Ap.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 331
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>   (* la la la *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 332
Time: 0.013s">
<div class="time" style="width: 1.063829787234%"></div>
<pre>refine ((concat_Ap q2 _ @@ 1) @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 332
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Now we can cancel another path *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 334
Time: 0.009s">
<div class="time" style="width: 0.73649754500818%"></div>
<pre>rewrite concat_pp_p; apply whiskerL.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 334
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* And set up for an application of [ap]. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 336
Time: 0.007s">
<div class="time" style="width: 0.57283142389525%"></div>
<pre>rewrite ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 336
Time: 0.005s">
<div class="time" style="width: 0.40916530278232%"></div>
<pre>
    Fail rewrite &lt;- ap_pp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 337
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>    (* again? *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 338
Time: 0.012s">
<div class="time" style="width: 0.98199672667758%"></div>
<pre>refine ((ap_pp g2 _ _)^ @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 338
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>
    apply ap.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 339
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Now we apply the triangle identity [eisadj]. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 341
Time: 0.02s">
<div class="time" style="width: 1.6366612111293%"></div>
<pre>rewrite inv_pp, ap_pp, ap_V.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 341
Time: 0.006s">
<div class="time" style="width: 0.49099836333879%"></div>
<pre>
    Fail rewrite &lt;- eisadj.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 342
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>   (* oh, let this be the last time please *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 343
Time: 0.041s">
<div class="time" style="width: 3.3551554828151%"></div>
<pre>refine ((((inverse2 (eisadj q (f1 x))^) @@ 1) @@ 1) @ _).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (* Finally, we rearrange and it becomes a naturality square. *)
   </pre>
</div>
<div class="code" title="File: Factorization.v
Line: 345
Time: 0.009s">
<div class="time" style="width: 0.73649754500818%"></div>
<pre>rewrite concat_pp_p; apply moveR_Vp.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 345
Time: 0.027s">
<div class="time" style="width: 2.2094926350246%"></div>
<pre>
    rewrite &lt;- ap_V, inv_V, &lt;- ap_compose.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 346
Time: 0.007s">
<div class="time" style="width: 0.57283142389525%"></div>
<pre>
    exact (concat_A1p (eisretr q) (q1 x)).</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 347
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 348
Time: 0.332s">
<div class="time" style="width: 27.168576104746%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 349
Time: 0.098s">
<div class="time" style="width: 8.0196399345336%"></div>
<pre>

End FactSys.</pre>
</div>
<div class="code" title="File: Factorization.v
Line: 352
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

